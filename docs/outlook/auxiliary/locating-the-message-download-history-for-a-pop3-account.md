---
title: Localizar o histórico de download de mensagens de uma conta POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 90a51150-5c2c-4d5b-8717-5dacc8532744
description: Este tópico descreve como um cliente de email pode acessar a propriedade PidTagAttachDataBinary para obter o histórico de download de mensagens para uma conta POP3.
ms.openlocfilehash: ae12a044098aa4f42e1c2e5936e82da3d7a128dd
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/04/2018
ms.locfileid: "25399548"
---
# <a name="locating-the-message-download-history-for-a-pop3-account"></a><span data-ttu-id="6c97a-103">Localizar o histórico de download de mensagens de uma conta POP3</span><span class="sxs-lookup"><span data-stu-id="6c97a-103">Locating the message download history for a POP3 account</span></span>

<span data-ttu-id="6c97a-104">Este tópico descreve como um cliente de email pode acessar a propriedade [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) para obter o histórico de download de mensagens para uma conta POP3.</span><span class="sxs-lookup"><span data-stu-id="6c97a-104">This topic describes how a mail client can access the [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) property to get the message download history for a POP3 account.</span></span> 

<span data-ttu-id="6c97a-105"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_WhyGetUIDLHistory"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-105"></span></span>

## <a name="why-get-the-message-download-history"></a><span data-ttu-id="6c97a-106">Por que obter o histórico de download de mensagens?</span><span class="sxs-lookup"><span data-stu-id="6c97a-106">Why get the message download history?</span></span>

<span data-ttu-id="6c97a-107">O provedor de protocolo POP (Post Office Protocol) do Outlook permite aos usuários recuperarem e baixarem novas mensagens de email em seu dispositivo local e, posteriormente, manter ou excluir essas mensagens de email no servidor de email.</span><span class="sxs-lookup"><span data-stu-id="6c97a-107">The Post Office Protocol (POP) provider for Outlook allows users to retrieve and download new email messages on their local device, and subsequently to leave or delete these email messages on the mail server.</span></span> <span data-ttu-id="6c97a-108">Quando o cliente de email verifica se há novas mensagens para baixar, deve ser capaz de identificar e baixar somente as novas mensagens dessa Caixa de Entrada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-108">When the mail client checks for new messages to download, it has to be able to identify and download only the new messages for that Inbox.</span></span> <span data-ttu-id="6c97a-109">O cliente de email faz isso, primeiramente, usando o comando UIDL (listagem de ID exclusiva) para obter um mapa de cada mensagem que já foi enviada para essa Caixa de Entrada com uma UID (identificação exclusiva).</span><span class="sxs-lookup"><span data-stu-id="6c97a-109">The mail client does this by first using the UIDL (Unique ID Listing) command, which obtains a map of each message that has ever been delivered to that Inbox to a unique identifier (UID).</span></span> <span data-ttu-id="6c97a-110">O cliente também obtém o histórico de download de mensagens para mensagens baixadas ou excluídas na caixa de entrada desse cliente.</span><span class="sxs-lookup"><span data-stu-id="6c97a-110">The client also gets the message download history for messages that have been downloaded or deleted for the Inbox on that client.</span></span> <span data-ttu-id="6c97a-111">Usando o mapa de UID e o histórico de download de mensagens, o cliente pode identificar as mensagens ausentes do histórico como novas e baixá-las em seguida.</span><span class="sxs-lookup"><span data-stu-id="6c97a-111">Using the message UID map and download history, the client can then identify those messages that are absent in the history as new and, hence, should be downloaded.</span></span>
  
<span data-ttu-id="6c97a-112">Para obter o histórico de download de mensagens da Caixa de Entrada:</span><span class="sxs-lookup"><span data-stu-id="6c97a-112">To get the message download history for an Inbox:</span></span>
  
- <span data-ttu-id="6c97a-113">Siga as etapas deste tópico para encontrar a propriedade **PidTagAttachDataBinary**, que contém o histórico em um BLOB (objeto grande binário) que segue um formato específico.</span><span class="sxs-lookup"><span data-stu-id="6c97a-113">Follow the steps in this topic to find the **PidTagAttachDataBinary** property, which contains the history in a binary large object (BLOB) that follows a specific format.</span></span> 
    
- <span data-ttu-id="6c97a-114">Continue com [Analisar o histórico de download de mensagens de uma conta POP3](parsing-the-message-download-history-for-a-pop3-account.md), que descreve como analisar este BLOB para identificar mensagens baixadas ou excluídas dessa Caixa de Entrada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-114">Continue with [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md), which describes how to parse this BLOB to identify messages that have been downloaded or deleted for that Inbox.</span></span>
    
## <a name="core-concepts-to-know-for-locating-the-message-download-history"></a><span data-ttu-id="6c97a-115">Conheça os principais conceitos para localizar o histórico de download de mensagens</span><span class="sxs-lookup"><span data-stu-id="6c97a-115">Core concepts to know for locating the message download history</span></span>

<span data-ttu-id="6c97a-116">O histórico de downloads de mensagens da Caixa de Entrada é armazenado em uma propriedade MAPI binária, **PidTagAttachDataBinary**, em um anexo de uma mensagem oculta na Caixa de Entrada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-116">The message download history for an Inbox is stored in a binary MAPI property, **PidTagAttachDataBinary**, on an attachment of a hidden message in the Inbox.</span></span> <span data-ttu-id="6c97a-117">A tabela 1 mostra os recursos para conceitos que ajudam a entender como localizar o histórico de download de mensagens.</span><span class="sxs-lookup"><span data-stu-id="6c97a-117">Table 1 shows resources for concepts that help you understand how to locate the message download history.</span></span>
  
<span data-ttu-id="6c97a-118">**Tabela 1. Conceitos fundamentais**</span><span class="sxs-lookup"><span data-stu-id="6c97a-118">**Table 1. Core concepts for understanding BCS**</span></span>

|<span data-ttu-id="6c97a-119">**Título do artigo**</span><span class="sxs-lookup"><span data-stu-id="6c97a-119">**Article title**</span></span>|<span data-ttu-id="6c97a-120">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="6c97a-120">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="6c97a-121">Pastas ocultas MAPI</span><span class="sxs-lookup"><span data-stu-id="6c97a-121">MAPI Hidden Folders</span></span>](https://msdn.microsoft.com/library/8b3b9c80-f7f4-4f37-bd6b-323469d020f1%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-122">O MAPI permite que os clientes de email armazenem informações em pastas e mensagens ocultas.</span><span class="sxs-lookup"><span data-stu-id="6c97a-122">MAPI allows mail clients to store information in hidden folders and hidden messages.</span></span> <span data-ttu-id="6c97a-123">As pastas ocultas estão na parte associada das pastas MAPI e normalmente contêm informações que não são visíveis e nem manipuladas pelos usuários.</span><span class="sxs-lookup"><span data-stu-id="6c97a-123">Hidden folders are in the associated part of MAPI folders and typically contain information that is not visible to and not to be manipulated by users.</span></span> <span data-ttu-id="6c97a-124">Os clientes decidem o formato e o conteúdo a ser armazenado em mensagens e pastas ocultas.</span><span class="sxs-lookup"><span data-stu-id="6c97a-124">Clients decide the format and contents to store in hidden messages in hidden folders.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-125">Mensagens MAPI</span><span class="sxs-lookup"><span data-stu-id="6c97a-125">MAPI Messages</span></span>](https://msdn.microsoft.com/library/417c113f-bd98-4515-85d1-09db7fc3a227%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-126">O MAPI armazena mensagens em pastas, seja na subárvore IPM padrão, que é visível para os usuários do cliente, ou fora da subárvore e invisíveis aos usuários.</span><span class="sxs-lookup"><span data-stu-id="6c97a-126">MAPI stores messages in folders, either in the standard IPM subtree that is visible to users of a client, or outside of the subtree and invisible to users.</span></span> <span data-ttu-id="6c97a-127">As mensagens podem ter dados adicionais armazenados em um anexo, que pode estar no formato de um arquivo, de outra mensagem ou de um objeto OLE.</span><span class="sxs-lookup"><span data-stu-id="6c97a-127">Messages can have additional data stored in an attachment, which can be in the form of a file, another message, or an OLE object.</span></span> <span data-ttu-id="6c97a-128">No caso do histórico de download de mensagens, o histórico é armazenado na propriedade de uma mensagem anexada a outra mensagem oculta.</span><span class="sxs-lookup"><span data-stu-id="6c97a-128">In the case of the message download history, the history is stored in a property of a message that is attached to another hidden message.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-129">Visão geral das propriedades de mensagens</span><span class="sxs-lookup"><span data-stu-id="6c97a-129">Message Properties Overview</span></span>](https://msdn.microsoft.com/library/447f54de-9f0d-4f73-89b6-bed9cfea9c15%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-130">Quando um cliente armazena informações em uma mensagem, ele realmente armazena as informações nas propriedades da mensagem.</span><span class="sxs-lookup"><span data-stu-id="6c97a-130">When a client stores information in a message, it actually stores the information in a property of the message.</span></span> <span data-ttu-id="6c97a-131">O MAPI suporta muitas propriedades, algumas sempre existem e podem ser definidas pelos clientes, outras são opcionais e os clientes não esperam que estejam disponíveis ou definidas com valores válidos.</span><span class="sxs-lookup"><span data-stu-id="6c97a-131">MAPI supports many properties—some always exist and can be set by clients, others are optional—and clients cannot expect them to be available or set to valid values.</span></span> <span data-ttu-id="6c97a-132">O histórico de download de mensagens é armazenado na propriedade **PidTagAttachDataBinary** de um anexo da mensagem oculta.</span><span class="sxs-lookup"><span data-stu-id="6c97a-132">The message download history is stored in the **PidTagAttachDataBinary** property of an attachment to a hidden message.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-133">Perfis MAPI</span><span class="sxs-lookup"><span data-stu-id="6c97a-133">MAPI Profiles</span></span>](https://msdn.microsoft.com/library/493c87a4-317d-47ec-850b-342cac59594b%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-134">Ao fazer logon em uma sessão, o cliente de email seleciona um perfil que descreve os provedores e serviços a serem usados.</span><span class="sxs-lookup"><span data-stu-id="6c97a-134">At logon time in a session, the mail client selects a profile that describes the providers and services to be used.</span></span> <span data-ttu-id="6c97a-135">Um perfil é dividido em seções que contêm propriedades.</span><span class="sxs-lookup"><span data-stu-id="6c97a-135">A profile is divided into sections that contain properties.</span></span> <span data-ttu-id="6c97a-136">Especificamente, as propriedades [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) e [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) sempre existem.</span><span class="sxs-lookup"><span data-stu-id="6c97a-136">In particular, the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) and [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) properties always exist.</span></span> <span data-ttu-id="6c97a-137">Uma chave de pesquisa do perfil é única entre todos os perfis e é armazenada na seção de perfil identificada por **MUID_PROFILE_INSTANCE** (que é definida em MAPIGUID.H).</span><span class="sxs-lookup"><span data-stu-id="6c97a-137">A profile's search key is unique among all profiles, and is stored in the profile section that is identified by **MUID_PROFILE_INSTANCE** (which is defined in MAPIGUID.H).</span></span> <span data-ttu-id="6c97a-138">Use [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) para abrir a seção e [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) para obter os valores das propriedades.</span><span class="sxs-lookup"><span data-stu-id="6c97a-138">Use [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) to open the section, and use [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) to get the property values.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-139">Tabelas de conteúdo</span><span class="sxs-lookup"><span data-stu-id="6c97a-139">Contents Tables</span></span>](https://msdn.microsoft.com/library/7b8efb4e-b5be-41b8-81bb-9aa1da421433%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-140">Provedores de repositório de mensagens implementam tabelas de conteúdo às suas pastas.</span><span class="sxs-lookup"><span data-stu-id="6c97a-140">Message store providers implement contents tables for their folders.</span></span> <span data-ttu-id="6c97a-141">Para mensagens ocultas na parte associada de uma pasta, os provedores de repositório de mensagens suportam tabelas de conteúdo associadas e os clientes podem usar o método [IMAPIContainer::GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) para retornar um apontador para a tabela de conteúdo associada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-141">For hidden messages in the associated part of a folder, message store providers support associated contents tables, and clients can use the [IMAPIContainer::GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) method to return a pointer to the associated contents table.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-142">Sobre restrições</span><span class="sxs-lookup"><span data-stu-id="6c97a-142">About Restrictions</span></span>](https://msdn.microsoft.com/library/e119fa20-08b8-4c8d-93fc-56037220890d%28Office.15%29.aspx) <br/> [<span data-ttu-id="6c97a-143">Tipos de restrições</span><span class="sxs-lookup"><span data-stu-id="6c97a-143">Types of Restrictions</span></span>](https://msdn.microsoft.com/library/0d3bd58b-7100-4117-91ac-27139715c85b%28Office.15%29.aspx) <br/> [<span data-ttu-id="6c97a-144">Criar uma restrição</span><span class="sxs-lookup"><span data-stu-id="6c97a-144">Building a Restriction</span></span>](https://msdn.microsoft.com/library/12abbd8c-f825-493e-af42-344371d9658e%28Office.15%29.aspx) <br/> [<span data-ttu-id="6c97a-145">Exemplo de código de restrição</span><span class="sxs-lookup"><span data-stu-id="6c97a-145">Sample Restriction Code</span></span>](https://msdn.microsoft.com/library/9b82097c-dbd6-4ba0-a6cb-292301f9402b%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-146">Em MAPI, os clientes podem usar restrições para filtrar tabelas de conteúdo a fim de procurar linhas que representam as mensagens que tenham uma determinada propriedade definidas como um valor específico.</span><span class="sxs-lookup"><span data-stu-id="6c97a-146">In MAPI, clients can use restrictions to filter contents tables, to search for rows that represent messages that have a certain property set to a specific value.</span></span> <span data-ttu-id="6c97a-147">As restrições são definidas usando a estrutura de dados [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx), que pode conter uma união de estruturas de restrição mais especializadas.</span><span class="sxs-lookup"><span data-stu-id="6c97a-147">Restrictions are defined by using the [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) data structure, which can contain a union of more specialized restriction structures.</span></span> <span data-ttu-id="6c97a-148">O método [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) aplica uma restrição e recupera a primeira linha em uma tabela que atende aos critérios de restrição.</span><span class="sxs-lookup"><span data-stu-id="6c97a-148">The [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) method applies a restriction and retrieves the first row in a table that matches the restriction criteria.</span></span>  <br/> |
|[<span data-ttu-id="6c97a-149">Sobre como registrar repositórios para indexação</span><span class="sxs-lookup"><span data-stu-id="6c97a-149">About Registering Stores for Indexing</span></span>](https://msdn.microsoft.com/library/dd2aa06a-96e8-1291-18b5-fc3c40b74e4d%28Office.15%29.aspx) <br/> |<span data-ttu-id="6c97a-150">Use a propriedade [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) para verificar o tipo de provedor de repositório.</span><span class="sxs-lookup"><span data-stu-id="6c97a-150">Use the [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) property to verify the type of store provider.</span></span> <span data-ttu-id="6c97a-151">Por exemplo, para verificar se um repositório é do Exchange, a propriedade **PidTagStoreProvider** deve retornar um valor representado pela constante **pbExchangeProviderPrimaryUserGuid**, que é definida no arquivo de cabeçalho público edkmdb.h.</span><span class="sxs-lookup"><span data-stu-id="6c97a-151">For example, to verify whether a store is an Exchange store, the **PidTagStoreProvider** property should return a value represented by the constant **pbExchangeProviderPrimaryUserGuid**, which is defined in the public header file edkmdb.h.</span></span>  <br/> |
   
## <a name="locating-the-appropriate-hidden-message-and-attachment"></a><span data-ttu-id="6c97a-152">Localizar o anexo e a mensagem oculta apropriados</span><span class="sxs-lookup"><span data-stu-id="6c97a-152">Locating the appropriate hidden message and attachment</span></span>

<span data-ttu-id="6c97a-153">Agora que sabemos que o histórico de download de mensagens de uma Caixa de Entrada está na propriedade **PidTagAttachDataBinary** de um anexo de uma mensagem oculta, o procedimento para localizar o anexo apropriado da mensagem oculta apropriada envolve os seguintes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="6c97a-153">Now that we know the message download history for an Inbox is in the **PidTagAttachDataBinary** property of an attachment to a hidden message, the procedure to locate the appropriate attachment of the appropriate hidden message involves the following procedures:</span></span> 
  
1. [<span data-ttu-id="6c97a-154">Localizar a mensagem oculta apropriada</span><span class="sxs-lookup"><span data-stu-id="6c97a-154">Find the appropriate hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg)
    
2. [<span data-ttu-id="6c97a-155">Localizar o anexo apropriado da mensagem oculta</span><span class="sxs-lookup"><span data-stu-id="6c97a-155">Find the appropriate attachment of the hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment)
    
3. [<span data-ttu-id="6c97a-156">Acessar a propriedade PidTagAttachDataBinary do anexo da mensagem</span><span class="sxs-lookup"><span data-stu-id="6c97a-156">Access the PidTagAttachDataBinary property of the message attachment</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp)

<span data-ttu-id="6c97a-157"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-157"></span></span>

### <a name="find-the-appropriate-hidden-message"></a><span data-ttu-id="6c97a-158">Localizar a mensagem oculta apropriada</span><span class="sxs-lookup"><span data-stu-id="6c97a-158">Find the appropriate hidden message</span></span>

1. <span data-ttu-id="6c97a-159">Obtenha a propriedade [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) do perfil, na seção de perfil especificada por **MUID_PROFILE_INSTANCE**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-159">Get the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) property from the profile, in the profile section specified by **MUID_PROFILE_INSTANCE**.</span></span>
    
2. <span data-ttu-id="6c97a-160">Abra os Conteúdos Associados na pasta da Caixa de Entrada chamando **IMAPIContainer::GetContentsTable**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-160">Open the Associated Contents for the Inbox folder by calling **IMAPIContainer::GetContentsTable**.</span></span>
    
3. <span data-ttu-id="6c97a-161">Crie uma restrição baseada nas propriedades [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**), **PidTagSearchKey** (**PR_SEARCH_KEY**) e [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) para obter uma tabela que contém todas as mensagens ocultas nos Conteúdos Associados da Caixa de Entrada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-161">Create a restriction based on the [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**), **PidTagSearchKey** (**PR_SEARCH_KEY**), and [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) properties to get a table that contains all the hidden messages in the Associated Contents of the Inbox.</span></span> <span data-ttu-id="6c97a-162">A seguir apresentamos um exemplo de uma restrição extraída de [Localizar o histórico de UIDL POP3](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span><span class="sxs-lookup"><span data-stu-id="6c97a-162">The following is an example of a restriction extracted from [Locating the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span></span>
    
   ```cpp
      SRestriction rgRes[3]; 
      SPropValue rgProps[3]; 
      rgRes[0].rt = RES_AND; 
      rgRes[0].res.resAnd.cRes = 2; 
      rgRes[0].res.resAnd.lpRes = &amp;rgRes[1]; 
      rgRes[1].rt = RES_PROPERTY; 
      rgRes[1].res.resProperty.relop = RELOP_EQ; 
      rgRes[1].res.resProperty.ulPropTag = PR_CONVERSATION_KEY; 
      rgRes[1].res.resProperty.lpProp = &amp;rgProps[0]; 
      rgRes[2].rt = RES_PROPERTY; 
      rgRes[2].res.resProperty.relop = RELOP_EQ; 
      rgRes[2].res.resProperty.ulPropTag = PR_MESSAGE_CLASS; 
      rgRes[2].res.resProperty.lpProp = &amp;rgProps[1]; 
      rgProps[0].ulPropTag = PR_CONVERSATION_KEY; 
      rgProps[0].Value.bin = pVals[iSearchKey].Value.bin; // PR_SEARCH_KEY from the profile 
      rgProps[1].ulPropTag = PR_MESSAGE_CLASS; 
      rgProps[1].Value.LPSZ = (LPTSTR)"IPM.MessageManager";
   ```

4. <span data-ttu-id="6c97a-163">Na tabela, encontre a mensagem oculta usando **IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-163">From the table, find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
5. <span data-ttu-id="6c97a-164">Se a etapa 4 não conseguir localizar uma mensagem oculta, altere a restrição para usar **PidTagSearchKey** (**PR_SEARCH_KEY**) ao invés de **PidTagConversationKey**, conforme mostrado abaixo:</span><span class="sxs-lookup"><span data-stu-id="6c97a-164">If step 4 fails to find a hidden message, change the restriction to use **PidTagSearchKey** (**PR_SEARCH_KEY**) instead of **PidTagConversationKey**, as shown below:</span></span>
    
   ```cpp
    rgRes[1].res.resProperty.ulPropTag = rgProps[0].ulPropTag = PR_SEARCH_KEY;
   ```

6. <span data-ttu-id="6c97a-165">Encontre a mensagem oculta usando **IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-165">Find the hidden message using **IMAPITable::FindRow**.</span></span> 
    
7. <span data-ttu-id="6c97a-166">Se houver falha na etapa 6, altere a restrição para usar [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) como sendo igual ao seguinte valor (mostrado abaixo usando a substituição de estilo `printf` por brevidade).</span><span class="sxs-lookup"><span data-stu-id="6c97a-166">If Step 6 fails, change the restriction to use [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) being equal to the following value (shown below using  `printf` style substitution for brevity).</span></span> 
    
   ```cpp
    "Outlook Message Manager (%s) (KEY: %s)", PR_PROFILE_NAME, HexFromBin(PR_SEARCH_KEY)
   ```

8. <span data-ttu-id="6c97a-167">Encontre a mensagem oculta usando **IMAPITable::FindRow**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-167">Find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
9. <span data-ttu-id="6c97a-168">Se você estiver executando o Outlook 2010 ou posterior, use os seguintes valores para **PidTagProfileName** (**PR_PROFILE_NAME**) e **PidTagSearchKey** (**PR _SEARCH_KEY**), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="6c97a-168">If you are running Outlook 2010 or a later version, use the following values for **PidTagProfileName** (**PR_PROFILE_NAME**) and **PidTagSearchKey** (**PR_SEARCH_KEY**), respectively.</span></span>
    
   ```cpp
    CHAR g_szGeneralKey[] = "General Key"; 
    const SBinary g_binGeneralKey = {sizeof(g_szGeneralKey), (LPBYTE)g_szGeneralKey};
   ```

   <span data-ttu-id="6c97a-169">Execute as etapas 3 a 8.</span><span class="sxs-lookup"><span data-stu-id="6c97a-169">Run through Steps 3 through 8.</span></span> <span data-ttu-id="6c97a-170">Se isso não conseguir localizar uma mensagem, volte para as etapas originais 3 a 8.</span><span class="sxs-lookup"><span data-stu-id="6c97a-170">If this fails to find a message, fall back to the original steps 3 through 8.</span></span>
    
10. <span data-ttu-id="6c97a-171">Abra a mensagem oculta encontrada na etapa 4, 6 ou 8.</span><span class="sxs-lookup"><span data-stu-id="6c97a-171">Open the hidden message found in Step 4, 6, or 8.</span></span>

<span data-ttu-id="6c97a-172"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-172"></span></span>

### <a name="find-the-appropriate-attachment-of-the-hidden-message"></a><span data-ttu-id="6c97a-173">Localizar o anexo apropriado da mensagem oculta</span><span class="sxs-lookup"><span data-stu-id="6c97a-173">Find the appropriate attachment of the hidden message</span></span>

<span data-ttu-id="6c97a-174">Como a mensagem oculta pode conter mais de um anexo, procure o anexo apropriado na seguinte ordem.</span><span class="sxs-lookup"><span data-stu-id="6c97a-174">Because the hidden message may have more than one attachment, look for the appropriate attachment in the following order.</span></span>
  
> [!NOTE]
> <span data-ttu-id="6c97a-175">Este procedimento usa novamente a substituição de estilo `printf` para brevidade.</span><span class="sxs-lookup"><span data-stu-id="6c97a-175">This procedure again uses the  `printf` style substitution for brevity.</span></span> 

1. <span data-ttu-id="6c97a-176">Procure um anexo cuja [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) corresponde à seguinte cadeia de caracteres, em que `szEmailAddress` é o endereço SMTP do usuário, conforme especificado no perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="6c97a-176">Look for an attachment whose [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) matches the following string, where  `szEmailAddress` is the user's SMTP address, as specified in the user's profile.</span></span> <span data-ttu-id="6c97a-177">.</span><span class="sxs-lookup"><span data-stu-id="6c97a-177"></span></span> 
    
   ```cpp
    "BlobPOP%s", szEmailAddress
   ```

2. <span data-ttu-id="6c97a-178">Procure um anexo cuja [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) corresponde a "BlobPOP%s", `szEmailAddress`.</span><span class="sxs-lookup"><span data-stu-id="6c97a-178">Look for an attachment whose [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
3. <span data-ttu-id="6c97a-179">Procure um anexo cuja [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) corresponde a "BlobPOP%s", `szEmailAddress`.</span><span class="sxs-lookup"><span data-stu-id="6c97a-179">Look for an attachment whose [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
4. <span data-ttu-id="6c97a-180">Procure um anexo cuja **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) corresponde a "Blob%.8x", `dwAcctUID` e em que `dwAcctUID` vem de [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span><span class="sxs-lookup"><span data-stu-id="6c97a-180">Look for an attachment whose **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) matches "Blob%.8x",  `dwAcctUID`, where  `dwAcctUID` comes from [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span></span> <span data-ttu-id="6c97a-181">Você pode usar o método [IOlkAccount::GetProp](iolkaccount-getprop.md) para acessar a propriedade **PROP_ACCT_MINI_UID**.</span><span class="sxs-lookup"><span data-stu-id="6c97a-181">You can use the [IOlkAccount::GetProp](iolkaccount-getprop.md) method to access the **PROP_ACCT_MINI_UID** property.</span></span> 

<span data-ttu-id="6c97a-182"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-182"></span></span>

### <a name="access-the-pidtagattachdatabinary-property-of-the-message-attachment"></a><span data-ttu-id="6c97a-183">Acessar a propriedade PidTagAttachDataBinary do anexo da mensagem</span><span class="sxs-lookup"><span data-stu-id="6c97a-183">Access the PidTagAttachDataBinary property of the message attachment</span></span>

<span data-ttu-id="6c97a-184">Após localizar o anexo de mensagem apropriado da mensagem oculta, use **IMAPIProp::GetProps** para ler a propriedade **PidTagAttachDataBinary** do anexo.</span><span class="sxs-lookup"><span data-stu-id="6c97a-184">After locating the appropriate message attachment of the hidden message, use **IMAPIProp::GetProps** to read the **PidTagAttachDataBinary** property of the attachment.</span></span> 

<span data-ttu-id="6c97a-185"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_NextSteps"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-185"></span></span>

## <a name="next-steps"></a><span data-ttu-id="6c97a-186">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="6c97a-186">Next steps</span></span>

<span data-ttu-id="6c97a-187">Você aprendeu neste tópico a localizar o histórico de download de mensagens na Caixa de Entrada de um cliente de email POP3.</span><span class="sxs-lookup"><span data-stu-id="6c97a-187">You have learned from this topic how to locate the message download history for the Inbox of a POP3 mail client.</span></span> <span data-ttu-id="6c97a-188">Consulte [Analisar o histórico de download de mensagens de uma conta POP3](parsing-the-message-download-history-for-a-pop3-account.md) para aprender como analisar este histórico a fim de identificar mensagens baixadas ou excluídas da Caixa de Entrada.</span><span class="sxs-lookup"><span data-stu-id="6c97a-188">See [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md) to learn how to parse this history to identify messages that have been downloaded or deleted for the Inbox.</span></span> 

<span data-ttu-id="6c97a-189"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AdditionalRsc"> </a></span><span class="sxs-lookup"><span data-stu-id="6c97a-189"></span></span>

## <a name="see-also"></a><span data-ttu-id="6c97a-190">Confira também</span><span class="sxs-lookup"><span data-stu-id="6c97a-190">See also</span></span>

- [<span data-ttu-id="6c97a-191">Gerenciar o download de mensagens de contas POP3</span><span class="sxs-lookup"><span data-stu-id="6c97a-191">Managing message downloads for POP3 accounts</span></span>](managing-message-downloads-for-pop3-accounts.md)   
- [<span data-ttu-id="6c97a-192">Analisar o histórico de download de mensagens de uma conta POP3</span><span class="sxs-lookup"><span data-stu-id="6c97a-192">Parsing the message download history for a POP3 account</span></span>](parsing-the-message-download-history-for-a-pop3-account.md)
- [<span data-ttu-id="6c97a-193">Localizar o histórico de UIDL POP3</span><span class="sxs-lookup"><span data-stu-id="6c97a-193">Locating the POP3 UIDL History</span></span>](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx)
    

