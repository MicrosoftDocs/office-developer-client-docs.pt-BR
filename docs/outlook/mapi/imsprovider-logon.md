---
title: IMSProviderLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMSProvider.Logon
api_type:
- COM
ms.assetid: 890d9cbe-3570-4cf0-aeae-667c0e5ba181
description: 'Última modificação: 23 de julho de 2011'
ms.openlocfilehash: 9c7f62c69c7a06f7ca0e4bfddcf789cddc536ea6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309664"
---
# <a name="imsproviderlogon"></a><span data-ttu-id="5fc66-103">IMSProvider::Logon</span><span class="sxs-lookup"><span data-stu-id="5fc66-103">IMSProvider::Logon</span></span>

  
  
<span data-ttu-id="5fc66-104">**Aplica-se a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="5fc66-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="5fc66-105">Registra MAPI em uma instância de um provedor de armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-105">Logs MAPI on to one instance of a message store provider.</span></span>
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulFlags,
  LPCIID lpInterface,
  ULONG FAR * lpcbSpoolSecurity,
  LPBYTE FAR * lppbSpoolSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPMSLOGON FAR * lppMSLogon,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a><span data-ttu-id="5fc66-106">Parâmetros</span><span class="sxs-lookup"><span data-stu-id="5fc66-106">Parameters</span></span>

 <span data-ttu-id="5fc66-107">_lpMAPISup_</span><span class="sxs-lookup"><span data-stu-id="5fc66-107">_lpMAPISup_</span></span>
  
> <span data-ttu-id="5fc66-108">[in] Um ponteiro para o objeto de suporte MAPI atual para o armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-108">[in] A pointer to the current MAPI support object for the message store.</span></span>
    
 <span data-ttu-id="5fc66-109">_ulUIParam_</span><span class="sxs-lookup"><span data-stu-id="5fc66-109">_ulUIParam_</span></span>
  
> <span data-ttu-id="5fc66-110">[in] Um alça para a janela pai de quaisquer caixas de diálogo ou janelas que esse método exibe.</span><span class="sxs-lookup"><span data-stu-id="5fc66-110">[in] A handle to the parent window of any dialog boxes or windows this method displays.</span></span> 
    
 <span data-ttu-id="5fc66-111">_lpszProfileName_</span><span class="sxs-lookup"><span data-stu-id="5fc66-111">_lpszProfileName_</span></span>
  
> <span data-ttu-id="5fc66-112">[in] Um ponteiro para uma cadeia de caracteres que contém o nome do perfil que está sendo usado para logon do provedor de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-112">[in] A pointer to a string that contains the name of the profile being used for store provider logon.</span></span> <span data-ttu-id="5fc66-113">Essa cadeia de caracteres pode ser exibida em caixas de diálogo, escritas em um arquivo de log ou simplesmente ignoradas.</span><span class="sxs-lookup"><span data-stu-id="5fc66-113">This string can be displayed in dialog boxes, written out to a log file, or simply ignored.</span></span> <span data-ttu-id="5fc66-114">Ele deverá estar no formato Unicode se o sinalizador MAPI_UNICODE estiver definido no _parâmetro ulFlags._</span><span class="sxs-lookup"><span data-stu-id="5fc66-114">It must be in Unicode format if the MAPI_UNICODE flag is set in the  _ulFlags_ parameter.</span></span> 
    
 <span data-ttu-id="5fc66-115">_cbEntryID_</span><span class="sxs-lookup"><span data-stu-id="5fc66-115">_cbEntryID_</span></span>
  
> <span data-ttu-id="5fc66-116">[in] O tamanho, em bytes, do identificador de entrada apontado pelo parâmetro _lpEntryID._</span><span class="sxs-lookup"><span data-stu-id="5fc66-116">[in] The size, in bytes, of the entry identifier pointed to by the  _lpEntryID_ parameter.</span></span> 
    
 <span data-ttu-id="5fc66-117">_lpEntryID_</span><span class="sxs-lookup"><span data-stu-id="5fc66-117">_lpEntryID_</span></span>
  
> <span data-ttu-id="5fc66-118">[in] Um ponteiro para o identificador de entrada para o armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-118">[in] A pointer to the entry identifier for the message store.</span></span> <span data-ttu-id="5fc66-119">Passar **nulo**  _em lpEntryID_ indica que um armazenamento de mensagens ainda não foi selecionado e que as caixas de diálogo que permitem ao usuário selecionar um armazenamento de mensagens podem ser apresentadas.</span><span class="sxs-lookup"><span data-stu-id="5fc66-119">Passing **null** in  _lpEntryID_ indicates that a message store has not yet been selected and that dialog boxes that enable the user to select a message store can be presented.</span></span> 
    
 <span data-ttu-id="5fc66-120">_ulFlags_</span><span class="sxs-lookup"><span data-stu-id="5fc66-120">_ulFlags_</span></span>
  
> <span data-ttu-id="5fc66-121">[in] Uma máscara de bits de sinalizadores que controla como o logon é realizado.</span><span class="sxs-lookup"><span data-stu-id="5fc66-121">[in] A bitmask of flags that controls how the logon is performed.</span></span> <span data-ttu-id="5fc66-122">Os sinalizadores a seguir podem ser definidos:</span><span class="sxs-lookup"><span data-stu-id="5fc66-122">The following flags can be set:</span></span>
    
<span data-ttu-id="5fc66-123">MAPI_DEFERRED_ERRORS</span><span class="sxs-lookup"><span data-stu-id="5fc66-123">MAPI_DEFERRED_ERRORS</span></span> 
  
> <span data-ttu-id="5fc66-124">A chamada tem permissão para ser bem-sucedida, mesmo se o objeto subjacente não estiver disponível para a implementação da chamada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-124">The call is allowed to succeed even if the underlying object is not available to the calling implementation.</span></span> <span data-ttu-id="5fc66-125">Se o objeto não estiver disponível, uma chamada subsequente para o objeto poderá criar um erro.</span><span class="sxs-lookup"><span data-stu-id="5fc66-125">If the object is not available, a subsequent call to the object might raise an error.</span></span>
    
<span data-ttu-id="5fc66-126">MAPI_UNICODE</span><span class="sxs-lookup"><span data-stu-id="5fc66-126">MAPI_UNICODE</span></span> 
  
> <span data-ttu-id="5fc66-127">As cadeias de caracteres passadas estão no formato Unicode.</span><span class="sxs-lookup"><span data-stu-id="5fc66-127">The passed-in strings are in Unicode format.</span></span> <span data-ttu-id="5fc66-128">Se MAPI_UNICODE não estiver definido, as cadeias de caracteres estão no formato ANSI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-128">If MAPI_UNICODE is not set, the strings are in ANSI format.</span></span>
    
<span data-ttu-id="5fc66-129">MDB_NO_DIALOG</span><span class="sxs-lookup"><span data-stu-id="5fc66-129">MDB_NO_DIALOG</span></span> 
  
> <span data-ttu-id="5fc66-130">Impede a exibição de caixas de diálogo de logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-130">Prevents the display of logon dialog boxes.</span></span> <span data-ttu-id="5fc66-131">Se esse sinalizador estiver definido, o valor de erro MAPI_E_LOGON_FAILED será retornado se o logon não for bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="5fc66-131">If this flag is set, the error value MAPI_E_LOGON_FAILED is returned if the logon is unsuccessful.</span></span> <span data-ttu-id="5fc66-132">Se esse sinalizador não estiver definido, o provedor do armazenamento de mensagens poderá solicitar que o usuário corrija um nome ou senha, insira um disco ou execute outras ações necessárias para estabelecer conexão com o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-132">If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions that are necessary to establish connection to the store.</span></span>
    
<span data-ttu-id="5fc66-133">MDB_NO_MAIL</span><span class="sxs-lookup"><span data-stu-id="5fc66-133">MDB_NO_MAIL</span></span> 
  
> <span data-ttu-id="5fc66-134">O armazenamento de mensagens não deve ser usado para enviar ou receber emails.</span><span class="sxs-lookup"><span data-stu-id="5fc66-134">The message store should not be used for sending or receiving mail.</span></span> <span data-ttu-id="5fc66-135">O sinalizador sinaliza MAPI para não notificar o spooler MAPI de que esse armazenamento de mensagens está sendo aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-135">The flag signals MAPI not to notify the MAPI spooler that this message store is being opened.</span></span> <span data-ttu-id="5fc66-136">Se esse sinalizador estiver definido e o armazenamento de mensagens estiver fortemente unido a um provedor de transporte, o provedor não precisará chamar o método [IMAPISupport::SpoolerNotify.](imapisupport-spoolernotify.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-136">If this flag is set and the message store is tightly coupled with a transport provider, the provider does not need to call the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method.</span></span> 
    
<span data-ttu-id="5fc66-137">MDB_TEMPORARY</span><span class="sxs-lookup"><span data-stu-id="5fc66-137">MDB_TEMPORARY</span></span> 
  
> <span data-ttu-id="5fc66-138">Logs no armazenamento para que as informações possam ser recuperadas programaticamente da seção de perfil, sem o uso de caixas de diálogo.</span><span class="sxs-lookup"><span data-stu-id="5fc66-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span></span> <span data-ttu-id="5fc66-139">Esse sinalizador instrui o MAPI de que o armazenamento não deve ser adicionado à tabela do armazenamento de mensagens e que o armazenamento não pode se tornar permanente.</span><span class="sxs-lookup"><span data-stu-id="5fc66-139">This flag instructs MAPI that the store is not to be added to the message store table and that the store cannot be made permanent.</span></span> <span data-ttu-id="5fc66-140">Se esse sinalizador estiver definido, os provedores de armazenamento de mensagens não precisarão chamar o [método IMAPISupport::ModifyProfile.](imapisupport-modifyprofile.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-140">If this flag is set, message store providers do not need to call the [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) method.</span></span> 
    
<span data-ttu-id="5fc66-141">MDB_WRITE</span><span class="sxs-lookup"><span data-stu-id="5fc66-141">MDB_WRITE</span></span> 
  
> <span data-ttu-id="5fc66-142">Solicita permissão de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="5fc66-142">Requests read/write permission.</span></span>
    
 <span data-ttu-id="5fc66-143">_lpInterface_</span><span class="sxs-lookup"><span data-stu-id="5fc66-143">_lpInterface_</span></span>
  
> <span data-ttu-id="5fc66-144">[in] Um ponteiro para o IID (identificador da interface) para o armazenamento de mensagens fazer logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-144">[in] A pointer to the interface identifier (IID) for the message store to log on to.</span></span> <span data-ttu-id="5fc66-145">Passar **nulo** indica que a interface MAPI do repositório de mensagens ( [IMsgStore](imsgstoreimapiprop.md)) é retornada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-145">Passing **null** indicates the MAPI interface for the message store ( [IMsgStore](imsgstoreimapiprop.md)) is returned.</span></span> <span data-ttu-id="5fc66-146">O  _parâmetro lpInterface_ também pode ser definido como um identificador para uma interface apropriada para o armazenamento de mensagens (por exemplo, IID_IUnknown ou IID_IMAPIProp).</span><span class="sxs-lookup"><span data-stu-id="5fc66-146">The  _lpInterface_ parameter can also be set to an identifier for an appropriate interface for the message store (for example, IID_IUnknown or IID_IMAPIProp).</span></span> 
    
 <span data-ttu-id="5fc66-147">_lpcbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="5fc66-147">_lpcbSpoolSecurity_</span></span>
  
> <span data-ttu-id="5fc66-148">[out] Um ponteiro para a variável na qual o provedor de armazenamento retorna o tamanho, em bytes, dos dados de validação no _parâmetro lppbSpoolSecurity._</span><span class="sxs-lookup"><span data-stu-id="5fc66-148">[out] A pointer to the variable in which the store provider returns the size, in bytes, of the validation data in the  _lppbSpoolSecurity_ parameter.</span></span> 
    
 <span data-ttu-id="5fc66-149">_lppbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="5fc66-149">_lppbSpoolSecurity_</span></span>
  
> <span data-ttu-id="5fc66-150">[out] Um ponteiro para o ponteiro para os dados de validação retornados.</span><span class="sxs-lookup"><span data-stu-id="5fc66-150">[out] A pointer to the pointer to the returned validation data.</span></span> <span data-ttu-id="5fc66-151">Esses dados de validação são fornecidos para que o método [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) possa registrar o spooler MAPI no mesmo armazenamento que o provedor de armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-151">This validation data is provided so the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method can log the MAPI spooler on to the same store as the message store provider.</span></span> 
    
 <span data-ttu-id="5fc66-152">_lppMAPIError_</span><span class="sxs-lookup"><span data-stu-id="5fc66-152">_lppMAPIError_</span></span>
  
> <span data-ttu-id="5fc66-153">[out] Um ponteiro para um ponteiro para a estrutura [MAPIERROR](mapierror.md) retornada, se alguma, que contenha informações de versão, componente e contexto para um erro.</span><span class="sxs-lookup"><span data-stu-id="5fc66-153">[out] A pointer to a pointer to the returned [MAPIERROR](mapierror.md) structure, if any, that contains version, component, and context information for an error.</span></span> <span data-ttu-id="5fc66-154">O  _parâmetro lppMAPIError_ pode ser definido como **nulo** se não houver **estrutura MAPIERROR** a ser retornada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-154">The  _lppMAPIError_ parameter can be set to **null** if there is no **MAPIERROR** structure to return.</span></span> 
    
 <span data-ttu-id="5fc66-155">_lppMSLogon_</span><span class="sxs-lookup"><span data-stu-id="5fc66-155">_lppMSLogon_</span></span>
  
> <span data-ttu-id="5fc66-156">[out] Um ponteiro para o ponteiro para o objeto de logon do armazenamento de mensagens para MAPI fazer logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-156">[out] A pointer to the pointer to the message store logon object for MAPI to log on to.</span></span>
    
 <span data-ttu-id="5fc66-157">_lppMDB_</span><span class="sxs-lookup"><span data-stu-id="5fc66-157">_lppMDB_</span></span>
  
> <span data-ttu-id="5fc66-158">[out] Um ponteiro para o ponteiro para o objeto de armazenamento de mensagens para o spooler MAPI e aplicativos cliente para fazer logoff.</span><span class="sxs-lookup"><span data-stu-id="5fc66-158">[out] A pointer to the pointer to the message store object for the MAPI spooler and client applications to log on to.</span></span>
    
## <a name="return-value"></a><span data-ttu-id="5fc66-159">Valor de retorno</span><span class="sxs-lookup"><span data-stu-id="5fc66-159">Return value</span></span>

<span data-ttu-id="5fc66-160">S_OK</span><span class="sxs-lookup"><span data-stu-id="5fc66-160">S_OK</span></span> 
  
> <span data-ttu-id="5fc66-161">A chamada foi bem-sucedida e retornou o valor ou os valores esperados.</span><span class="sxs-lookup"><span data-stu-id="5fc66-161">The call succeeded and has returned the expected value or values.</span></span>
    
<span data-ttu-id="5fc66-162">MAPI_E_FAILONEPROVIDER</span><span class="sxs-lookup"><span data-stu-id="5fc66-162">MAPI_E_FAILONEPROVIDER</span></span> 
  
> <span data-ttu-id="5fc66-163">Este provedor não pode fazer logoff, mas esse erro não deve desabilitar o serviço.</span><span class="sxs-lookup"><span data-stu-id="5fc66-163">This provider cannot log on, but this error should not disable the service.</span></span> 
    
<span data-ttu-id="5fc66-164">MAPI_E_LOGON_FAILED</span><span class="sxs-lookup"><span data-stu-id="5fc66-164">MAPI_E_LOGON_FAILED</span></span> 
  
> <span data-ttu-id="5fc66-165">Não foi possível estabelecer uma sessão de logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-165">A logon session could not be established.</span></span>
    
<span data-ttu-id="5fc66-166">MAPI_E_UNCONFIGURED</span><span class="sxs-lookup"><span data-stu-id="5fc66-166">MAPI_E_UNCONFIGURED</span></span> 
  
> <span data-ttu-id="5fc66-167">O perfil não contém informações suficientes para que o logon seja concluído.</span><span class="sxs-lookup"><span data-stu-id="5fc66-167">The profile does not contain enough information for the logon to complete.</span></span> <span data-ttu-id="5fc66-168">Quando esse valor é retornado, o MAPI chama a função de ponto de entrada do serviço de mensagens do provedor de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-168">When this value is returned, MAPI calls the message store provider's message-service entry point function.</span></span>
    
<span data-ttu-id="5fc66-169">MAPI_E_USER_CANCEL</span><span class="sxs-lookup"><span data-stu-id="5fc66-169">MAPI_E_USER_CANCEL</span></span> 
  
> <span data-ttu-id="5fc66-170">O usuário cancelou a operação, normalmente clicando no botão Cancelar **em** uma caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="5fc66-170">The user canceled the operation, typically by clicking the **Cancel** button in a dialog box.</span></span> 
    
<span data-ttu-id="5fc66-171">MAPI_E_UNKNOWN_CPID</span><span class="sxs-lookup"><span data-stu-id="5fc66-171">MAPI_E_UNKNOWN_CPID</span></span> 
  
> <span data-ttu-id="5fc66-172">O servidor não está configurado para dar suporte à página de código do cliente.</span><span class="sxs-lookup"><span data-stu-id="5fc66-172">The server is not configured to support the client's code page.</span></span>
    
<span data-ttu-id="5fc66-173">MAPI_E_UNKNOWN_LCID</span><span class="sxs-lookup"><span data-stu-id="5fc66-173">MAPI_E_UNKNOWN_LCID</span></span> 
  
> <span data-ttu-id="5fc66-174">O servidor não está configurado para dar suporte às informações de localidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="5fc66-174">The server is not configured to support the client's locale information.</span></span>
    
<span data-ttu-id="5fc66-175">MAPI_W_ERRORS_RETURNED</span><span class="sxs-lookup"><span data-stu-id="5fc66-175">MAPI_W_ERRORS_RETURNED</span></span> 
  
> <span data-ttu-id="5fc66-176">A chamada foi bem-sucedida, mas o provedor do armazenamento de mensagens tem informações de erro disponíveis.</span><span class="sxs-lookup"><span data-stu-id="5fc66-176">The call succeeded, but the message store provider has error information available.</span></span> <span data-ttu-id="5fc66-177">Quando esse aviso é retornado, a chamada deve ser tratada como bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="5fc66-177">When this warning is returned, the call should be handled as successful.</span></span> <span data-ttu-id="5fc66-178">Para testar esse aviso, use a **HR_FAILED** macro.</span><span class="sxs-lookup"><span data-stu-id="5fc66-178">To test for this warning, use the **HR_FAILED** macro.</span></span> <span data-ttu-id="5fc66-179">Para obter mais informações, consulte [Usando macros para tratamento de erros.](using-macros-for-error-handling.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-179">For more information, see [Using Macros for Error Handling](using-macros-for-error-handling.md).</span></span> <span data-ttu-id="5fc66-180">Para obter as informações de erro do provedor, chame o [método IMAPISession::GetLastError.](imapisession-getlasterror.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-180">To get the error information from the provider, call the [IMAPISession::GetLastError](imapisession-getlasterror.md) method.</span></span> 
    
## <a name="remarks"></a><span data-ttu-id="5fc66-181">Comentários</span><span class="sxs-lookup"><span data-stu-id="5fc66-181">Remarks</span></span>

<span data-ttu-id="5fc66-182">O MAPI chama o método **IMSProvider::Logon** para fazer a maior parte do processamento necessário para obter acesso a um armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-182">MAPI calls the **IMSProvider::Logon** method to do the majority of processing necessary to obtain access to a message store.</span></span> <span data-ttu-id="5fc66-183">Os provedores de armazenamento de mensagens validam qualquer credencial de usuário necessária para acessar um determinado armazenamento e retornar um objeto de armazenamento de mensagens no parâmetro  _lppMDB_ em que o spooler MAPI e os aplicativos cliente podem fazer logoff.</span><span class="sxs-lookup"><span data-stu-id="5fc66-183">Message store providers validate any user credentials necessary to access a particular store and return a message store object in the  _lppMDB_ parameter that the MAPI spooler and client applications can log on to.</span></span> 
  
<span data-ttu-id="5fc66-184">Além do objeto de armazenamento de mensagens retornado para uso do spooler de cliente e MAPI, o provedor também retorna um objeto de logon do armazenamento de mensagens para o MAPI usar no controle do armazenamento aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-184">In addition to the returned message store object for client and MAPI spooler use, the provider also returns a message store logon object for MAPI to use in controlling the opened store.</span></span> <span data-ttu-id="5fc66-185">O objeto de logon do armazenamento de mensagens e o objeto de armazenamento de mensagens devem estar fortemente vinculados dentro do provedor de armazenamento de mensagens para que cada um possa afetar o outro.</span><span class="sxs-lookup"><span data-stu-id="5fc66-185">The message store logon object and the message store object should be tightly linked inside the message store provider so each can affect the other.</span></span> <span data-ttu-id="5fc66-186">O uso do objeto de armazenamento e do objeto de logon deve ser idêntico; deve haver uma correspondência um-para-um entre o objeto de logon e o objeto de armazenamento de forma que os objetos agem como se fosse um objeto que expõe duas interfaces.</span><span class="sxs-lookup"><span data-stu-id="5fc66-186">The use of the store object and the logon object should be identical; there should be a one-to-one correspondence between the logon object and the store object such that the objects act as if they are one object that exposes two interfaces.</span></span> <span data-ttu-id="5fc66-187">Os dois objetos também devem ser criados juntos e liberados juntos.</span><span class="sxs-lookup"><span data-stu-id="5fc66-187">The two objects should also be created together and freed together.</span></span> 
  
<span data-ttu-id="5fc66-188">O objeto de suporte MAPI, criado por MAPI e passado para o provedor no parâmetro  _lpMAPISup,_ fornece acesso a funções em MAPI que o provedor requer.</span><span class="sxs-lookup"><span data-stu-id="5fc66-188">The MAPI support object, created by MAPI and passed to the provider in the  _lpMAPISup_ parameter, provides access to functions in MAPI that the provider requires.</span></span> <span data-ttu-id="5fc66-189">Isso inclui funções que salvam e recuperam informações de perfil, acessar os livros de endereços e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="5fc66-189">These include functions that save and retrieve profile information, access address books, and so on.</span></span> <span data-ttu-id="5fc66-190">O  _ponteiro lpMAPISup_ pode ser diferente para cada armazenamento aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-190">The  _lpMAPISup_ pointer can be different for each store that is opened.</span></span> <span data-ttu-id="5fc66-191">Durante o processamento de chamadas para um armazenamento de mensagens após o logon, o provedor de armazenamento deve usar a variável  _lpMAPISup_ específica para esse armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-191">While processing calls for a message store after logon, the store provider should use the  _lpMAPISup_ variable that is specific to that store.</span></span> <span data-ttu-id="5fc66-192">Para qualquer chamada de Logon que abre um armazenamento de mensagens e é bem-sucedida na criação de um objeto de **logon** do armazenamento de mensagens, o provedor deve salvar um ponteiro para o objeto de suporte MAPI no objeto de logon do armazenamento e deve chamar o método [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) para adicionar uma referência para o objeto de suporte.</span><span class="sxs-lookup"><span data-stu-id="5fc66-192">For any **Logon** call that opens a message store and succeeds in creating a message store logon object, the provider must save a pointer to the MAPI support object in the store logon object and must call the [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) method to add a reference for the support object.</span></span> 
  
<span data-ttu-id="5fc66-193">O _parâmetro ulUIParam_ deve ser usado se o provedor apresentar caixas de diálogo durante a chamada **de logon.**</span><span class="sxs-lookup"><span data-stu-id="5fc66-193">The  _ulUIParam_ parameter should be used if the provider presents dialog boxes during the **Logon** call.</span></span> <span data-ttu-id="5fc66-194">No entanto, caixas de diálogo não devem ser  _apresentadas se ulFlags_ contiver o MDB_NO_DIALOG sinalizador.</span><span class="sxs-lookup"><span data-stu-id="5fc66-194">However, dialog boxes should not be presented if  _ulFlags_ contains the MDB_NO_DIALOG flag.</span></span> <span data-ttu-id="5fc66-195">Se uma interface do usuário precisar ser chamada, mas  _ulFlags_ não permitir ou se, por algum outro motivo, uma interface do usuário não puder ser exibida, o provedor deverá retornar MAPI_E_LOGON_FAILED.</span><span class="sxs-lookup"><span data-stu-id="5fc66-195">If a user interface needs to be called but  _ulFlags_ does not allow it, or if for some other reason a user interface cannot be displayed, the provider should return MAPI_E_LOGON_FAILED.</span></span> <span data-ttu-id="5fc66-196">Se **o logon** exibir uma caixa de diálogo e o usuário cancelar o  logon, normalmente clicando no botão Cancelar da caixa de diálogo, o provedor deverá retornar MAPI_E_USER_CANCEL.</span><span class="sxs-lookup"><span data-stu-id="5fc66-196">If **Logon** displays a dialog box and the user cancels the logon, typically by clicking the dialog box's **Cancel** button, the provider should return MAPI_E_USER_CANCEL.</span></span> 
  
<span data-ttu-id="5fc66-197">O  _parâmetro lpEntryID_ pode ser **nulo** ou apontar para um identificador de entrada de armazenamento não mapeado criado anteriormente por esse armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-197">The  _lpEntryID_ parameter can either be **null** or point to an unwrapped store entry identifier that this message store previously created.</span></span> <span data-ttu-id="5fc66-198">Se  _lpEntryID_ aponta para um identificador de entrada não mapeada, esse identificador de entrada pode vir de um dos vários locais:</span><span class="sxs-lookup"><span data-stu-id="5fc66-198">If  _lpEntryID_ points to an unwrapped entry identifier, that entry identifier can come from one of several places:</span></span> 
  
- <span data-ttu-id="5fc66-199">Pode ser um identificador de entrada que o provedor de armazenamento anteriormente baixou e escreveu na seção de perfil como uma **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) propriedade.</span><span class="sxs-lookup"><span data-stu-id="5fc66-199">It can be an entry identifier that the store provider previously wrapped and wrote to the profile section as a **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) property.</span></span>
    
- <span data-ttu-id="5fc66-200">Pode ser um identificador de entrada que o provedor anteriormente abalou e retornou a um cliente de chamada como uma **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) .</span><span class="sxs-lookup"><span data-stu-id="5fc66-200">It can be an entry identifier that the provider previously wrapped and returned to a calling client as a **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) property.</span></span> 
    
- <span data-ttu-id="5fc66-201">Pode ser um identificador de entrada que o provedor anteriormente abalou e retornou a um cliente de chamada como PR_ENTRYID **propriedade** de um objeto de armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-201">It can be an entry identifier that the provider previously wrapped and returned to a calling client as the **PR_ENTRYID** property of a message store object.</span></span> 
    
<span data-ttu-id="5fc66-202">Em qualquer um desses casos, é possível que o identificador de entrada foi criado em um computador diferente do que está sendo usado no momento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-202">In any of these cases, it is possible that the entry identifier was created on a different computer than the one currently being used.</span></span>
  
<span data-ttu-id="5fc66-203">Quando  _lpEntryID_ não é **nulo**, ele deve conter todas as informações necessárias para identificar e localizar o armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="5fc66-203">When  _lpEntryID_ is not **null**, it should contain all of the information needed to identify and locate the message store.</span></span> <span data-ttu-id="5fc66-204">Essas informações podem incluir nomes de volume de rede, números de telefone, nomes de contas de usuário e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="5fc66-204">This information can include network volume names, phone numbers, user account names, and so on.</span></span> <span data-ttu-id="5fc66-205">Se a conexão com o armazenamento não puder ser feita usando os dados no identificador de entrada, o provedor do armazenamento deverá exibir uma caixa de diálogo que permita ao usuário selecionar o armazenamento a ser aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-205">If the connection to the store cannot be made by using the data in the entry identifier, the store provider should display a dialog box that enables the user to select the store to be opened.</span></span> <span data-ttu-id="5fc66-206">Uma caixa de diálogo pode ser necessária, por exemplo, se um servidor foi renomeado, um nome de conta foi alterado ou partes da rede não estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="5fc66-206">A dialog box might be required, for example, if a server has been renamed, an account name has changed, or portions of the network are not available.</span></span>
  
<span data-ttu-id="5fc66-207">Quando  _lpEntryID_ for **nulo**, o armazenamento de mensagens a ser usado ainda não foi selecionado.</span><span class="sxs-lookup"><span data-stu-id="5fc66-207">When  _lpEntryID_ is **null**, the message store to use has not yet been selected.</span></span> <span data-ttu-id="5fc66-208">O provedor ainda pode acessar um armazenamento sem exibir uma caixa de diálogo se ele oferece suporte a outros métodos para especificar o armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-208">The provider can still access a store without displaying a dialog box if it supports further methods to specify the store.</span></span> <span data-ttu-id="5fc66-209">Por exemplo, o provedor pode verificar seu arquivo de inicialização ou pode procurar propriedades adicionais que foram colocadas em sua seção de perfil do serviço de mensagens na configuração.</span><span class="sxs-lookup"><span data-stu-id="5fc66-209">For example, the provider can check its initialization file, or it can look for additional properties that were placed in its or its message service's profile section at configuration.</span></span>
  
<span data-ttu-id="5fc66-210">Se um provedor achar que todas as informações necessárias não estão no perfil, ele deverá retornar MAPI_E_UNCONFIGURED.</span><span class="sxs-lookup"><span data-stu-id="5fc66-210">If a provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED.</span></span> <span data-ttu-id="5fc66-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span><span class="sxs-lookup"><span data-stu-id="5fc66-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span></span> <span data-ttu-id="5fc66-212">MAPI automatically creates a new profile section for a new store; essa nova seção de perfil pode ser temporária ou permanente, dependendo de como ela foi adicionada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-212">MAPI automatically creates a new profile section for a new store; this new profile section can be temporary or permanent, depending on how it has been added.</span></span> <span data-ttu-id="5fc66-213">Se o provedor de armazenamento chamar o método **IMAPISupport::ModifyProfile,** a nova seção de perfil se tornará permanente e o armazenamento será adicionado à lista de armazenamentos de mensagens retornados pelo método [IMAPISession::GetMsgStoresTable.](imapisession-getmsgstorestable.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-213">If the store provider calls the **IMAPISupport::ModifyProfile** method, the new profile section becomes permanent and the store is added to the list of message stores returned by the [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) method.</span></span> 
  
<span data-ttu-id="5fc66-214">O  _parâmetro lpInterface_ especifica a IID da interface necessária para o objeto de armazenamento recém-aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-214">The  _lpInterface_ parameter specifies the IID of the interface required for the newly opened store object.</span></span> <span data-ttu-id="5fc66-215">Passar **nulo**  _em lpInterface_ especifica que a interface do repositório de mensagens MAPI, **IMsgStore**, é necessária.</span><span class="sxs-lookup"><span data-stu-id="5fc66-215">Passing **null** in  _lpInterface_ specifies that the MAPI message store interface, **IMsgStore**, is required.</span></span> <span data-ttu-id="5fc66-216">Passar o objeto de repositório de mensagens, IID_IMsgStore, também especifica que **iMsgStore** é necessário.</span><span class="sxs-lookup"><span data-stu-id="5fc66-216">Passing the message store object, IID_IMsgStore, also specifies that **IMsgStore** is required.</span></span> <span data-ttu-id="5fc66-217">Se IID_IUnknown for passado em  _lpInterface_, o provedor deve abrir o repositório usando qualquer interface derivada de [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) é melhor para o provedor (novamente, normalmente é **IMsgStore**).</span><span class="sxs-lookup"><span data-stu-id="5fc66-217">If IID_IUnknown is passed in  _lpInterface_, the provider should open the store by using whatever interface derived from [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) is best for the provider (again, this is typically **IMsgStore**).</span></span> <span data-ttu-id="5fc66-218">Quando IID_IUnknown é passada, a implementação de chamada usa o método [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) para selecionar uma interface depois que a operação de abertura do armazenamento é bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="5fc66-218">When IID_IUnknown is passed, the calling implementation uses the [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) method to select an interface after the store open operation succeeds.</span></span> 
  
<span data-ttu-id="5fc66-219">A chamada **IMSProvider::Logon** deve retornar informações suficientes, como um caminho para o armazenamento e credenciais para acessar o armazenamento, para permitir que o spooler MAPI faça logon no mesmo armazenamento que o provedor de armazenamento faz sem apresentar uma caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="5fc66-219">The **IMSProvider::Logon** call should return sufficient information, such as a path to the store and credentials for accessing the store, to allow the MAPI spooler to log on to the same store that the store provider does without presenting a dialog box.</span></span> <span data-ttu-id="5fc66-220">Os  _parâmetros lpcbSpoolSecurity_  _e lppbSpoolSecurity_ são usados para retornar essas informações.</span><span class="sxs-lookup"><span data-stu-id="5fc66-220">The  _lpcbSpoolSecurity_ and  _lppbSpoolSecurity_ parameters are used to return this information.</span></span> <span data-ttu-id="5fc66-221">O provedor aloca a memória para esses dados passando um ponteiro para um buffer no parâmetro _lpfAllocateBuffer_ da função [MSProviderInit;](msproviderinit.md) o provedor coloca o tamanho desse buffer em _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="5fc66-221">The provider allocates the memory for this data by passing a pointer to a buffer in the [MSProviderInit](msproviderinit.md) function's  _lpfAllocateBuffer_ parameter; the provider places the size of this buffer in  _lpcbSpoolSecurity_.</span></span> 
  
<span data-ttu-id="5fc66-222">O MAPI libera esse buffer quando apropriado.</span><span class="sxs-lookup"><span data-stu-id="5fc66-222">MAPI frees this buffer when appropriate.</span></span> <span data-ttu-id="5fc66-223">Se o logon do spooler MAPI para o armazenamento pode ser realizado apenas a partir das informações na seção de perfil, o provedor pode retornar nulo em  _lppbSpoolSecurity_ e 0 para o tamanho das informações em  _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="5fc66-223">If the MAPI spooler's logon to the store can be accomplished from the information in the profile section alone, the provider can return null in  _lppbSpoolSecurity_ and 0 for the information's size in  _lpcbSpoolSecurity_.</span></span> <span data-ttu-id="5fc66-224">O logon do spooler MAPI ocorre como parte de um processo diferente do logon do armazenamento; como o buffer que contém as informações passadas é copiado entre processos, ele pode não estar na memória no mesmo local para o processo do spooler MAPI do processo do provedor de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="5fc66-224">The MAPI spooler logon occurs as part of a different process than the store logon; because the buffer that contains the passed information gets copied between processes, it might not be in memory at the same location for the MAPI spooler process as for the store provider process.</span></span> <span data-ttu-id="5fc66-225">Portanto, um provedor não deve colocar endereços nesse buffer.</span><span class="sxs-lookup"><span data-stu-id="5fc66-225">Therefore, a provider shouldn't put addresses into this buffer.</span></span> <span data-ttu-id="5fc66-226">Para obter mais informações sobre o logon do spooler MAPI, consulte o [método IMSProvider::SpoolerLogon.](imsprovider-spoolerlogon.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-226">For more information about MAPI spooler logon, see the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method.</span></span> 
  
<span data-ttu-id="5fc66-227">A maioria dos provedores de armazenamento usa o método [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) do objeto de suporte passado no parâmetro  _lpMAPISup_ para salvar e recuperar credenciais e opções do usuário.</span><span class="sxs-lookup"><span data-stu-id="5fc66-227">Most store providers use the [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) method of the support object passed in the  _lpMAPISup_ parameter for saving and retrieving user credentials and options.</span></span> <span data-ttu-id="5fc66-228">**OpenProfileSection permite** que um provedor de armazenamento salve informações arbitrárias adicionais em uma seção de perfil e associá-la a um recurso específico.</span><span class="sxs-lookup"><span data-stu-id="5fc66-228">**OpenProfileSection** enables a store provider to save additional arbitrary information in a profile section and associate it with a particular resource.</span></span> <span data-ttu-id="5fc66-229">Por exemplo, um provedor de armazenamento pode salvar o nome da conta de usuário e a senha associados a um recurso e quaisquer caminhos ou outras informações necessárias para acessar esse recurso.</span><span class="sxs-lookup"><span data-stu-id="5fc66-229">For example, a store provider can save the user account name and password associated with a resource and any paths or other information needed to access that resource.</span></span> 
  
<span data-ttu-id="5fc66-230">Propriedades com identificadores de 0x6600 por meio 0x67FF são propriedades seguras disponíveis para o provedor para seu próprio uso para armazenar dados particulares em seções de perfil.</span><span class="sxs-lookup"><span data-stu-id="5fc66-230">Properties with property identifiers 0x6600 through 0x67FF are secure properties available to the provider for its own use to store private data in profile sections.</span></span> <span data-ttu-id="5fc66-231">Para obter mais informações sobre os usos de propriedades em objetos de seção de perfil, consulte o [método IProfSect : IMAPIProp.](iprofsectimapiprop.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-231">For more information about the uses of properties in profile section objects, see the [IProfSect : IMAPIProp](iprofsectimapiprop.md) method.</span></span> 
  
<span data-ttu-id="5fc66-232">Além de quaisquer dados privados em propriedades com identificadores 0x6600 por meio do 0x67FF, o provedor de armazenamento deve fornecer informações para a propriedade **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) em sua seção de perfil.</span><span class="sxs-lookup"><span data-stu-id="5fc66-232">In addition to any private data in properties with identifiers 0x6600 through 0x67FF, the store provider should provide information for the **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in its profile section.</span></span> <span data-ttu-id="5fc66-233">Ele deve ser colocado em **PR_DISPLAY_NAME** nome de exibição do próprio provedor — uma cadeia de caracteres de identificação (por exemplo, "Microsoft Personal Information Store") exibida aos usuários para que eles possam distinguir esse armazenamento de mensagens de outros aos quais possam ter acesso.</span><span class="sxs-lookup"><span data-stu-id="5fc66-233">It should put in **PR_DISPLAY_NAME** the display name of the provider itself — an identifying string (for example, "Microsoft Personal Information Store") that is displayed to users so they can distinguish this message store from others they might have access to.</span></span> <span data-ttu-id="5fc66-234">**PR_DISPLAY_NAME** geralmente contém um nome de servidor, um nome de conta de usuário ou um caminho.</span><span class="sxs-lookup"><span data-stu-id="5fc66-234">**PR_DISPLAY_NAME** commonly contains a server name, user account name, or path.</span></span> 
  
<span data-ttu-id="5fc66-235">Algumas propriedades de seção de perfil são visíveis na tabela do armazenamento de mensagens; outros ficam visíveis durante a instalação, instalação e configuração do subsistema MAPI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-235">Some profile section properties are visible in the message store table; others are visible during setup, installation, and configuration of the MAPI subsystem.</span></span> <span data-ttu-id="5fc66-236">O provedor normalmente fornece informações para essas propriedades visíveis para uma nova seção de perfil, que ainda não inclui credenciais salvas ou informações privadas, e quando descobre que essas informações de propriedade foram alteradas.</span><span class="sxs-lookup"><span data-stu-id="5fc66-236">The provider typically provides information for these visible properties both for a new profile section, which does not yet include saved credentials or private information, and when it finds that property information has changed.</span></span> <span data-ttu-id="5fc66-237">Para obter mais informações sobre seções de perfil, consulte [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span><span class="sxs-lookup"><span data-stu-id="5fc66-237">For more information about profile sections, see [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span></span>
  
<span data-ttu-id="5fc66-238">Depois de fazer logor com êxito em um usuário e antes de retornar ao MAPI, o provedor de armazenamento deve criar a matriz de propriedades para a linha de status do recurso e chamar o método [IMAPISupport::ModifyStatusRow.](imapisupport-modifystatusrow.md)</span><span class="sxs-lookup"><span data-stu-id="5fc66-238">After successfully logging on a user, and before returning to MAPI, the store provider should create the array of properties for the status row for the resource and call the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> 
  
 <span data-ttu-id="5fc66-239">As chamadas de **logon** que abrem os armazenamentos de mensagens que já estão abertos para a sessão MAPI atual ignoram grande parte do processamento descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="5fc66-239">**Logon** calls that open message stores that are already open for the current MAPI session skip much of the processing previously described.</span></span> <span data-ttu-id="5fc66-240">Essas chamadas não criam linhas de status, retornam objetos de logon do armazenamento de mensagens, chamam **AddRef** para o objeto de suporte MAPI ou retornam dados para logon do spooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-240">These calls do not create status rows, return message store logon objects, call **AddRef** for the MAPI support object, or return data for MAPI spooler logon.</span></span> <span data-ttu-id="5fc66-241">Essas chamadas retornam S_OK e retornam um objeto de armazenamento de mensagens com a interface solicitada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-241">These calls do return S_OK and return a message store object with the requested interface.</span></span> 
  
<span data-ttu-id="5fc66-242">Para detectar essas chamadas, o provedor deve manter uma lista no objeto do provedor de armazenamento de mensagens dos armazenamentos já abertos para esse objeto de provedor.</span><span class="sxs-lookup"><span data-stu-id="5fc66-242">To detect such calls, the provider should maintain a list in the message store provider object of stores already open for this provider object.</span></span> <span data-ttu-id="5fc66-243">Ao processar uma **chamada de Logon,** o provedor deve verificar essa lista de lojas abertas e determinar se o armazenamento ao qual fazer logon já está aberto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-243">When processing a **Logon** call, the provider should scan this list of open stores and determine whether the store to be logged on to is already open.</span></span> <span data-ttu-id="5fc66-244">Se for, as credenciais do usuário não precisam ser verificadas e a exibição de uma caixa de diálogo deve ser evitada, se possível.</span><span class="sxs-lookup"><span data-stu-id="5fc66-244">If it is, user credentials do not need to be checked and the display of a dialog box should be avoided, if possible.</span></span> <span data-ttu-id="5fc66-245">Se as caixas de diálogo devem ser exibidas, o provedor deve verificar as informações retornadas para ver se um armazenamento foi aberto uma segunda vez.</span><span class="sxs-lookup"><span data-stu-id="5fc66-245">If dialog boxes must be displayed, the provider should check returned information to see whether a store has been opened a second time.</span></span> <span data-ttu-id="5fc66-246">Além disso, o provedor deve verificar se há aberturas duplicadas usando  _lpEntryID_ no início do processamento de **chamada** de logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-246">In addition, the provider should check for duplicate openings by using  _lpEntryID_ at the beginning of **Logon** call processing.</span></span> 
  
<span data-ttu-id="5fc66-247">O processamento padrão para uma **chamada de Logon** que acessa um armazenamento aberto é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="5fc66-247">Standard processing for a **Logon** call that accesses an open store is as follows:</span></span> 
  
1. <span data-ttu-id="5fc66-248">O provedor de armazenamento chama **AddRef** para o objeto de armazenamento existente se a nova interface que está sendo solicitada for a mesma que a interface para o armazenamento existente.</span><span class="sxs-lookup"><span data-stu-id="5fc66-248">The store provider calls **AddRef** for the existing store object if the new interface being requested is the same as the interface for the existing store.</span></span> <span data-ttu-id="5fc66-249">Caso contrário, ele **chamará QueryInterface** para obter a nova interface.</span><span class="sxs-lookup"><span data-stu-id="5fc66-249">Otherwise, it calls **QueryInterface** to get the new interface.</span></span> <span data-ttu-id="5fc66-250">Se o armazenamento não suportar a nova interface, o provedor deverá retornar o valor de erro MAPI_E_INTERFACE_NOT_SUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="5fc66-250">If the store does not support the new interface, the provider should return the error value MAPI_E_INTERFACE_NOT_SUPPORTED.</span></span> 
    
2. <span data-ttu-id="5fc66-251">O provedor retorna um ponteiro para a interface necessária do objeto de armazenamento existente  _em lppMDB_.</span><span class="sxs-lookup"><span data-stu-id="5fc66-251">The provider returns a pointer to the required interface of the existing store object in  _lppMDB_.</span></span>
    
3. <span data-ttu-id="5fc66-252">O provedor retorna **nulo**  _em lppMSLogon_.</span><span class="sxs-lookup"><span data-stu-id="5fc66-252">The provider returns **null** in  _lppMSLogon_.</span></span>
    
4. <span data-ttu-id="5fc66-253">O provedor não deve abrir o perfil do objeto de suporte passado na chamada.</span><span class="sxs-lookup"><span data-stu-id="5fc66-253">The provider should not open the profile for the support object passed in the call.</span></span> <span data-ttu-id="5fc66-254">Além disso, ele não deve registrar um identificador exclusivo do provedor, registrar uma linha de status ou retornar dados de logon do spooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-254">In addition, it should not register a provider unique identifier, register a status row, or return MAPI spooler logon data.</span></span>
    
5. <span data-ttu-id="5fc66-255">O provedor não deve chamar **AddRef para** o objeto de suporte, porque ele não exige um ponteiro para o objeto.</span><span class="sxs-lookup"><span data-stu-id="5fc66-255">The provider should not call **AddRef** for the support object, because it does not require a pointer to the object.</span></span> 
    
<span data-ttu-id="5fc66-256">Sempre que possível, os provedores devem retornar as cadeias de caracteres de erro e aviso apropriadas para chamadas de **Logon,** pois isso facilita bastante a carga dos usuários ao determinar por que algo não funcionou.</span><span class="sxs-lookup"><span data-stu-id="5fc66-256">Whenever possible, providers should return appropriate error and warning strings for **Logon** calls, because doing so greatly eases the burden of users in determining why something did not work.</span></span> <span data-ttu-id="5fc66-257">Para retornar essas cadeias de caracteres, um provedor define os membros na **estrutura MAPIERROR.**</span><span class="sxs-lookup"><span data-stu-id="5fc66-257">To return these strings, a provider sets the members in the **MAPIERROR** structure.</span></span> <span data-ttu-id="5fc66-258">O MAPI procura, usa e libera a estrutura **MAPIERROR** se ela for retornada por um provedor.</span><span class="sxs-lookup"><span data-stu-id="5fc66-258">MAPI looks for, uses, and releases the **MAPIERROR** structure if it is returned by a provider.</span></span> 
  
<span data-ttu-id="5fc66-259">A memória para **essa estrutura MAPIERROR** deve ser alocada usando o buffer passado em _lpfAllocateBuffer_ na **chamada MSProviderInit.**</span><span class="sxs-lookup"><span data-stu-id="5fc66-259">Memory for this **MAPIERROR** structure should be allocated by using the buffer passed in  _lpfAllocateBuffer_ on the **MSProviderInit** call.</span></span> <span data-ttu-id="5fc66-260">Quaisquer sequências de caracteres de erro contidas na estrutura retornada deverão estar no formato Unicode se MAPI_UNICODE estiver definida no **logon** _ulFlags;_ caso contrário, elas deverão estar no conjunto de caracteres ANSI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-260">Any error strings contained in the returned structure should be in Unicode format if MAPI_UNICODE is set in the **Logon** _ulFlags;_ otherwise, they should be in the ANSI character set.</span></span> 
  
<span data-ttu-id="5fc66-261">Para a maioria dos valores de erro **retornados de Logon,** o MAPI desabilita os serviços de mensagem aos quais o provedor com falha pertence.</span><span class="sxs-lookup"><span data-stu-id="5fc66-261">For most error values returned from **Logon**, MAPI disables the message services to which the failing provider belongs.</span></span> <span data-ttu-id="5fc66-262">O MAPI não chamará nenhum provedor que pertença a esses serviços durante a sessão MAPI.</span><span class="sxs-lookup"><span data-stu-id="5fc66-262">MAPI will not call any providers that belong to those services for the life of the MAPI session.</span></span> <span data-ttu-id="5fc66-263">Por outro lado, quando **Logon** retorna o valor MAPI_E_FAILONEPROVIDER de erro de seu logon, o MAPI não desabilita o serviço de mensagens ao qual o provedor pertence.</span><span class="sxs-lookup"><span data-stu-id="5fc66-263">In contrast, when **Logon** returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs.</span></span> <span data-ttu-id="5fc66-264">**O logon** deve MAPI_E_FAILONEPROVIDER se encontrar um erro que não garante a desabilitação de todo o serviço durante a sessão.</span><span class="sxs-lookup"><span data-stu-id="5fc66-264">**Logon** should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the life of the session.</span></span> <span data-ttu-id="5fc66-265">Por exemplo, um provedor pode retornar esse erro quando não permitir a exibição de uma interface do usuário e uma senha necessária não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="5fc66-265">For example, a provider might return this error when it does not allow the display of a user interface and a required password is unavailable.</span></span> 
  
<span data-ttu-id="5fc66-266">Se um provedor retornar MAPI_E_UNCONFIGURED de seu logon, o MAPI chamará a função de entrada do serviço de mensagens do provedor e repetirá o logon.</span><span class="sxs-lookup"><span data-stu-id="5fc66-266">If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon.</span></span> <span data-ttu-id="5fc66-267">O MAPI MSG_SERVICE_CONFIGURE como o contexto para dar ao serviço uma chance de se configurar.</span><span class="sxs-lookup"><span data-stu-id="5fc66-267">MAPI passes MSG_SERVICE_CONFIGURE as the context to give the service a chance to configure itself.</span></span> <span data-ttu-id="5fc66-268">Se o cliente tiver optado por permitir uma interface do usuário no logon, o serviço poderá apresentar sua folha de propriedades de configuração para que o usuário possa inserir informações de configuração.</span><span class="sxs-lookup"><span data-stu-id="5fc66-268">If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="5fc66-269">Confira também</span><span class="sxs-lookup"><span data-stu-id="5fc66-269">See also</span></span>



[<span data-ttu-id="5fc66-270">IMAPISession::GetMsgStoresTable</span><span class="sxs-lookup"><span data-stu-id="5fc66-270">IMAPISession::GetMsgStoresTable</span></span>](imapisession-getmsgstorestable.md)
  
[<span data-ttu-id="5fc66-271">IMAPISession::OpenMsgStore</span><span class="sxs-lookup"><span data-stu-id="5fc66-271">IMAPISession::OpenMsgStore</span></span>](imapisession-openmsgstore.md)
  
[<span data-ttu-id="5fc66-272">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="5fc66-272">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md)
  
[<span data-ttu-id="5fc66-273">IMAPISupport::ModifyProfile</span><span class="sxs-lookup"><span data-stu-id="5fc66-273">IMAPISupport::ModifyProfile</span></span>](imapisupport-modifyprofile.md)
  
[<span data-ttu-id="5fc66-274">IMAPISupport::ModifyStatusRow</span><span class="sxs-lookup"><span data-stu-id="5fc66-274">IMAPISupport::ModifyStatusRow</span></span>](imapisupport-modifystatusrow.md)
  
[<span data-ttu-id="5fc66-275">IMsgStore : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="5fc66-275">IMsgStore : IMAPIProp</span></span>](imsgstoreimapiprop.md)
  
[<span data-ttu-id="5fc66-276">IMSProvider::SpoolerLogon</span><span class="sxs-lookup"><span data-stu-id="5fc66-276">IMSProvider::SpoolerLogon</span></span>](imsprovider-spoolerlogon.md)
  
[<span data-ttu-id="5fc66-277">IProfSect : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="5fc66-277">IProfSect : IMAPIProp</span></span>](iprofsectimapiprop.md)
  
[<span data-ttu-id="5fc66-278">MAPIERROR</span><span class="sxs-lookup"><span data-stu-id="5fc66-278">MAPIERROR</span></span>](mapierror.md)
  
[<span data-ttu-id="5fc66-279">MSProviderInit</span><span class="sxs-lookup"><span data-stu-id="5fc66-279">MSProviderInit</span></span>](msproviderinit.md)
  
[<span data-ttu-id="5fc66-280">IMSProvider : IUnknown</span><span class="sxs-lookup"><span data-stu-id="5fc66-280">IMSProvider : IUnknown</span></span>](imsprovideriunknown.md)

