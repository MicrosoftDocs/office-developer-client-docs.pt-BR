---
title: Suporte à notificação de eventos
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: '�ltima altera��o: s�bado, 23 de julho de 2011'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/04/2018
ms.locfileid: "25397139"
---
# <a name="supporting-event-notification"></a><span data-ttu-id="a1e2f-103">Suporte à notificação de eventos</span><span class="sxs-lookup"><span data-stu-id="a1e2f-103">Supporting Event Notification</span></span>

  
  
<span data-ttu-id="a1e2f-104">**Aplica-se a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="a1e2f-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="a1e2f-105">Como suporte a notificação de evento pode ser complicado, MAPI fornece três métodos de objeto de suporte que implementem as partes mais difíceis do processo.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-105">Because supporting event notification can be complicated, MAPI supplies three support object methods that implement the most difficult parts of the process.</span></span> <span data-ttu-id="a1e2f-106">Esses métodos funcionam como uma unidade e um provedor deve usar todos os três ou nenhum deles.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-106">These methods work as a unit, and a provider must use all three or none of them.</span></span>
  
<span data-ttu-id="a1e2f-107">Métodos de suporte a MAPI usam chaves de notificação para gerenciar as conexões entre receptores de advise e os objetos que geram as notificações.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-107">The MAPI support methods use notification keys to manage the connections between the advise sinks and the objects that generate the notifications.</span></span> <span data-ttu-id="a1e2f-108">Uma chave de notificação é uma estrutura [NOTIFKEY](notifkey.md) que contém dados binários que identifica um objeto através dos processos.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-108">A notification key is a [NOTIFKEY](notifkey.md) structure that contains binary data that identifies an object across processes.</span></span> <span data-ttu-id="a1e2f-109">Uma chave de notificação geralmente é copiada do identificador de entrada de longo prazo do objeto de origem advise.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-109">A notification key is typically copied from the long-term entry identifier of the advise source object.</span></span> <span data-ttu-id="a1e2f-110">Se o cliente tem fornecido um identificador de entrada na chamada a **Advise**, você pode usá-lo para a chave de notificação.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-110">If the client has supplied an entry identifier in the call to **Advise**, you can use it for the notification key.</span></span> <span data-ttu-id="a1e2f-111">Se o parâmetro _lpEntryID_ **Advise** é NULL, use o identificador de entrada do objeto container possíveis mais externa, como o armazenamento de mensagens.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-111">If the  _lpEntryID_ parameter to **Advise** is NULL, use the entry identifier of the outermost possible container object, such as the message store.</span></span> 
  
<span data-ttu-id="a1e2f-112">Para usar os métodos de suporte, chame [IMAPISupport::Subscribe](imapisupport-subscribe.md) sempre que um cliente chama o método **Advise** para registrar para uma notificação.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-112">To use the support methods, call [IMAPISupport::Subscribe](imapisupport-subscribe.md) whenever a client calls your **Advise** method to register for a notification.</span></span> <span data-ttu-id="a1e2f-113">Alocar uma estrutura [NOTIFKEY](notifkey.md) e crie uma chave exclusiva de notificação para seu objeto de origem advise.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-113">Allocate a [NOTIFKEY](notifkey.md) structure and create a unique notification key for your advise source object.</span></span> <span data-ttu-id="a1e2f-114">Por exemplo, um provedor de armazenamento de mensagem que será solicitado para notificar um cliente quando uma mensagem é recebida em uma pasta particular cria uma chave de notificação para essa pasta.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-114">For example, a message store provider that is prompted to notify a client when a message is received into a particular folder creates a notification key for that folder.</span></span> <span data-ttu-id="a1e2f-115">Coletor de eventos de aviso de passagem um ponteiro para a estrutura **NOTIFKEY** na chamada a **Subscribe** junto com um ponteiro para o cliente.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-115">Pass a pointer to the **NOTIFKEY** structure in the call to **Subscribe** along with a pointer to the client's advise sink.</span></span> <span data-ttu-id="a1e2f-116">**Inscrever-se** chama o método de [AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) do coletor de eventos advise para incrementar sua contagem de referência e MAPI retém o ponteiro até que o registro será cancelado.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-116">**Subscribe** calls the advise sink's [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count and MAPI retains the pointer until the registration is canceled.</span></span> 
  
<span data-ttu-id="a1e2f-117">Você pode passar o sinalizador NOTIFY_SYNC para **inscrever-se** à solicitação **Notify** se comportam de maneira síncrona e não o retorno até que ele tornou todas as chamadas para os métodos [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) registrado receptores de aviso.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-117">You can pass the NOTIFY_SYNC flag to **Subscribe** to request that **Notify** behave synchronously and not return until it has made all calls to the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) methods of registered advise sinks.</span></span> <span data-ttu-id="a1e2f-118">Defina esse sinalizador apenas para seu próprio uso interno.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-118">Set this flag only for your own internal use.</span></span> <span data-ttu-id="a1e2f-119">Não defina-lo ao responder a um cliente **Advise** chamada.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-119">Do not set it when you respond to a client **Advise** call.</span></span> <span data-ttu-id="a1e2f-120">Notificação de evento entre clientes e provedores é sempre assíncrona.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-120">Event notification between clients and providers is always asynchronous.</span></span> <span data-ttu-id="a1e2f-121">Ou seja, a MAPI garante a que a chamada durante o qual um evento acontece irá retornar ao cliente antes que qualquer uma das chamadas **OnNotify** sejam feita.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-121">That is, MAPI guarantees that the call during which an event happens will return to the client before any of the **OnNotify** calls are made.</span></span> 
  
<span data-ttu-id="a1e2f-122">Se você definir o sinalizador NOTIFY_SYNC, não faça qualquer alteração dos objetos advise coletor de eventos e não passar um coletor de advise wrapper criado por [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) para **inscrever-se**.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-122">If you set the NOTIFY_SYNC flag, do not make any changes to any of the advise sink objects, and do not pass a wrapper advise sink created by [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) to **Subscribe**.</span></span> <span data-ttu-id="a1e2f-123">**HrThisThreadAdviseSink** cria uma versão de thread-safe do coletor de eventos de um advise para ser usado com apenas a notificação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-123">**HrThisThreadAdviseSink** creates a thread-safe version of an advise sink to be used with asynchronous notification only.</span></span> 
  
<span data-ttu-id="a1e2f-124">Se um coletor de advise registrado para notificação síncrona retorna de **OnNotify** com o sinalizador CALLBACK_DISCONTINUE definido, o [IMAPISupport::Notify](imapisupport-notify.md) define o sinalizador NOTIFY_CANCELED e retorna sem fazer quaisquer chamadas para **OnNotify**.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-124">If an advise sink registered for synchronous notification returns from **OnNotify** with the CALLBACK_DISCONTINUE flag set, [IMAPISupport::Notify](imapisupport-notify.md) sets the NOTIFY_CANCELED flag and returns without making any calls to **OnNotify**.</span></span> 
  
<span data-ttu-id="a1e2f-125">Depois que **Subscribe** tiver retornado, você não terá mais necessidade mantenha sua cópia do coletor de eventos de aviso do cliente.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-125">Once **Subscribe** has returned, you will no longer have any need to hold onto your copy of the client's advise sink.</span></span> <span data-ttu-id="a1e2f-126">Chame o método [IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) para liberá-la.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-126">Call its [IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) method to release it.</span></span> <span data-ttu-id="a1e2f-127">**Inscrever-se** retorna um número diferente de zero conexão que você deve retornar ao cliente.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-127">**Subscribe** returns a nonzero connection number that you should return to the client.</span></span> <span data-ttu-id="a1e2f-128">O número de conexão representa o vínculo entre a fonte de advise e o coletor de eventos advise.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-128">The connection number represents the link between the advise source and the advise sink.</span></span> <span data-ttu-id="a1e2f-129">Permanece válido até que o cliente faz uma chamada bem sucedida a **Unadvise**.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-129">It remains valid until the client makes a successful call to **Unadvise**.</span></span> 
  
<span data-ttu-id="a1e2f-130">Quando o cliente estiver pronto para cancelar um registro, ele chama o método **Unadvise** .</span><span class="sxs-lookup"><span data-stu-id="a1e2f-130">When the client is ready to cancel a registration, it calls your **Unadvise** method.</span></span> <span data-ttu-id="a1e2f-131">Passe o número de conexão da chamada **Unadvise** para [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span><span class="sxs-lookup"><span data-stu-id="a1e2f-131">Pass the connection number from the **Unadvise** call to [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span></span> <span data-ttu-id="a1e2f-132">**Cancelar inscrição** chama o método de **IUnknown:: Release** do coletor de eventos advise.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-132">**Unsubscribe** calls the advise sink's **IUnknown::Release** method.</span></span> <span data-ttu-id="a1e2f-133">Assim como acontece com **Advise** e **Unadvise**, chamadas para **inscrever-se** e o **cancelamento da assinatura** devem ser combinadas.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-133">As with **Advise** and **Unadvise**, calls to **Subscribe** and **Unsubscribe** must be paired.</span></span> <span data-ttu-id="a1e2f-134">Você deve fazer uma chamada de **cancelamento da assinatura** para cada chamada feita para **inscrever-se**.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-134">You must make one call to **Unsubscribe** for every call that is made to **Subscribe**.</span></span> <span data-ttu-id="a1e2f-135">No entanto, você não precisará chamar **Subscribe** toda vez que seu método **Advise** é chamado.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-135">However, you do not have to call **Subscribe** every time your **Advise** method is called.</span></span> <span data-ttu-id="a1e2f-136">Por outro lado, você poderá chamá-lo para Configurando notificações internas.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-136">Conversely, you can call it for setting up internal notifications.</span></span> 
  
<span data-ttu-id="a1e2f-137">Quando um evento ocorre, alocar uma ou mais estruturas de [notificação](notification.md) do tipo apropriado para o evento e chame [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="a1e2f-137">When an event occurs, allocate one or more [NOTIFICATION](notification.md) structures of the type appropriate for the event and call [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="a1e2f-138">**Notificar** gera uma notificação para cada coletor de eventos registrados advise.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-138">**Notify** generates a notification for each registered advise sink.</span></span> <span data-ttu-id="a1e2f-139">Você deve definir todos os membros não usados da estrutura de [notificação](notification.md) como zero.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-139">You should set all the unused members of the [NOTIFICATION](notification.md) structure to zero.</span></span> <span data-ttu-id="a1e2f-140">Essa técnica para inicializar a estrutura de **notificação** pode ajudar os clientes a criar menor, mais rápido e menos propenso implementações de **OnNotify** .</span><span class="sxs-lookup"><span data-stu-id="a1e2f-140">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="a1e2f-141">Observe que uma estrutura de **notificação** separada é necessária para cada evento, mesmo para vários eventos do mesmo tipo.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-141">Note that a separate **NOTIFICATION** structure is necessary for each event, even for multiple events of the same type.</span></span> <span data-ttu-id="a1e2f-142">Por exemplo, se três clientes registrados para fins de notificação de tabela em uma tabela específica e cinco linhas são adicionadas à tabela, você deverá criar estruturas de cinco **OBJECT_NOTIFICATION** da sua chamada **Notify** .</span><span class="sxs-lookup"><span data-stu-id="a1e2f-142">For example, if three clients are registered for table notification on a particular table and five rows are added to the table, you must create five **OBJECT_NOTIFICATION** structures for your **Notify** call.</span></span> <span data-ttu-id="a1e2f-143">Uma notificação de lote como isso resulta em desempenho melhor do que chamar **Notify** cinco vezes.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-143">A batch notification such as this results in better performance than calling **Notify** five times.</span></span> <span data-ttu-id="a1e2f-144">Para cada chamada **Notify** , MAPI chama o método de [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) do coletor de eventos cada advise registrados.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-144">For each **Notify** call, MAPI calls the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method of every registered advise sink.</span></span> <span data-ttu-id="a1e2f-145">Se houver não registrado receptores de aviso MAPI ignora a chamada.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-145">If there are no registered advise sinks, MAPI ignores the call.</span></span> 
  
<span data-ttu-id="a1e2f-146">Provedores de serviços que enviar notificações em lote devem solicitá-los para que eles podem ser interpretados a primeira notificação para o último.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-146">Service providers that send batched notifications must order them so that they can be interpreted from the first notification to the last.</span></span> <span data-ttu-id="a1e2f-147">Essa ordenação é especialmente necessária quando um lote de notificação contém uma série de eventos, como TABLE_ROW_ADDED com um evento que se refere a uma linha anterior que foi adicionada no evento outro no mesmo lote.</span><span class="sxs-lookup"><span data-stu-id="a1e2f-147">This ordering is especially necessary when a notification batch contains a series of events, such as TABLE_ROW_ADDED with one event that refers to a prior row that was added in another event in the same batch.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="a1e2f-148">Confira também</span><span class="sxs-lookup"><span data-stu-id="a1e2f-148">See also</span></span>



[<span data-ttu-id="a1e2f-149">Provedores de serviços MAPI</span><span class="sxs-lookup"><span data-stu-id="a1e2f-149">MAPI Service Providers</span></span>](mapi-service-providers.md)

