---
title: Salvar uma mensagem
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: 'Última modificação: 23 de julho de 2011'
ms.openlocfilehash: d5ceeb46bded101700aec696a17d690bde80ce6d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33420926"
---
# <a name="saving-a-message"></a><span data-ttu-id="e7c0e-103">Salvar uma mensagem</span><span class="sxs-lookup"><span data-stu-id="e7c0e-103">Saving a Message</span></span>

  
  
<span data-ttu-id="e7c0e-104">**Aplica-se a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="e7c0e-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="e7c0e-105">Antes de uma mensagem ser salva, os clientes normalmente chamam o método [IMAPIProp::SetProps](imapiprop-setprops.md) da mensagem para definir algumas propriedades além das propriedades de texto da mensagem, propriedades de anexo, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) e propriedades associadas à lista de destinatários.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-105">Before a message is saved, clients typically call the message's [IMAPIProp::SetProps](imapiprop-setprops.md) method to set a few properties in addition to the message text properties, attachment properties, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)), and properties associated with the recipient list.</span></span>
  
<span data-ttu-id="e7c0e-106">Definir a **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) para uma cadeia de caracteres como IPM. Observe que descreve a classe da mensagem de saída.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-106">Set the **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) property to a character string such as IPM.Note that describes the class of the outgoing message.</span></span> <span data-ttu-id="e7c0e-107">Embora os clientes deverão **PR_MESSAGE_CLASS** em todas as mensagens de saída, um valor padrão será fornecido pelo provedor do armazenamento de mensagens se você não defini-lo.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-107">Although clients should set **PR_MESSAGE_CLASS** on all outgoing messages, a default value is supplied by the message store provider if you do not set it.</span></span> <span data-ttu-id="e7c0e-108">A classe de mensagem padrão para mensagens de saída é IPM.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-108">The default message class for outgoing messages is IPM.</span></span> 
  
<span data-ttu-id="e7c0e-109">Defina MSGFLAG_UNSENT sinalizador na **propriedade PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="e7c0e-109">Set the MSGFLAG_UNSENT flag in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property.</span></span> <span data-ttu-id="e7c0e-110">Se desejado, de definida também as MSGFLAG_READ e MSGFLAG_UNMODIFIED sinalizadores.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-110">If desired, also set the MSGFLAG_READ and MSGFLAG_UNMODIFIED flags.</span></span> <span data-ttu-id="e7c0e-111">Definir o MSGFLAG_UNMODIFIED permite que uma mensagem em composição simule uma mensagem entregue.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-111">Setting the MSGFLAG_UNMODIFIED allows a message under composition to simulate a delivered message.</span></span> <span data-ttu-id="e7c0e-112">MSGFLAG_UNMODIFIED pode ser definida apenas por clientes antes que uma mensagem seja salva pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-112">MSGFLAG_UNMODIFIED can only be set by clients before a message has been saved for the first time.</span></span> 
  
<span data-ttu-id="e7c0e-113">Quando estiver pronto para fazer uma cópia permanente de uma mensagem não enviada, chame [IMAPIProp::SaveChanges](imapiprop-savechanges.md) sobre a mensagem e todos os seus anexos.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-113">When you are ready to make a permanent copy of an unsent message, call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message and all of its attachments.</span></span> <span data-ttu-id="e7c0e-114">Se você pretende enviar a mensagem imediatamente, não é necessário chamar **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-114">If you intend to send the message right away, you do not need to call **SaveChanges**.</span></span> <span data-ttu-id="e7c0e-115">A chamada para **SubmitMessage** salva internamente a mensagem como parte de seu processamento.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-115">The call to **SubmitMessage** internally saves the message as part of its processing.</span></span> 
  
<span data-ttu-id="e7c0e-116">Ao chamar **SaveChanges,** é uma boa ideia especificar o sinalizador KEEP_OPEN_READWRITE, que permite que a mensagem seja modificada posteriormente.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-116">When calling **SaveChanges**, it is a good idea to specify the KEEP_OPEN_READWRITE flag, which allows the message to be modified at a later time.</span></span> <span data-ttu-id="e7c0e-117">Outros sinalizadores de tabela de definição incluem FORCE_SAVE, que indica que a mensagem ou anexo deve ser fechado depois que as alterações são comprometidas, KEEP_OPEN_READONLY, o que indica que nenhuma outra alteração será feita e o sinalizador para permitir que o provedor de armazenamento de mensagens lote solicitações de cliente, MAPI_DEFERRED_ERRORS.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-117">Other settable flags include FORCE_SAVE, which indicates that the message or attachment should be closed after changes are committed, KEEP_OPEN_READONLY, which indicates that no further changes will be made, and the flag to allow the message store provider to batch client requests, MAPI_DEFERRED_ERRORS.</span></span>
  
<span data-ttu-id="e7c0e-118">É essencial que você chame **SaveChanges para** cada anexo na mensagem antes de chamar **SaveChanges** para a mensagem.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-118">It is essential that you call **SaveChanges** for every attachment in the message before you call **SaveChanges** for the message.</span></span> <span data-ttu-id="e7c0e-119">Se você não conseguir salvar um anexo, ele não será incluído na mensagem quando for enviado e não aparecerá na tabela de anexos da mensagem.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-119">If you fail to save an attachment, the attachment will not be included with the message when it is sent and it will not appear in the message's attachment table.</span></span> <span data-ttu-id="e7c0e-120">Se você não conseguir salvar a mensagem depois de salvar todos os anexos, a mensagem e os anexos serão perdidos.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-120">If you fail to save the message after saving all of the attachments, both the message and the attachments will be lost.</span></span> 
  
<span data-ttu-id="e7c0e-121">Quando **SaveChanges é** chamado, o provedor de armazenamento de mensagens atualiza as seguintes propriedades:</span><span class="sxs-lookup"><span data-stu-id="e7c0e-121">When **SaveChanges** is called, the message store provider updates the following properties:</span></span> 
  
- <span data-ttu-id="e7c0e-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lista todos os destinatários principais.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lists all primary recipients.</span></span>
    
- <span data-ttu-id="e7c0e-123">**PR_DISPLAY_TO** lista todos os destinatários de cópia carbono.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-123">**PR_DISPLAY_TO** lists all carbon copy recipients.</span></span> 
    
- <span data-ttu-id="e7c0e-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lista todos os destinatários com cópia carbono.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lists all blind carbon copy recipients.</span></span>
    
- <span data-ttu-id="e7c0e-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="e7c0e-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span></span>
    
- <span data-ttu-id="e7c0e-126">**PR_MESSAGE_FLAGS** define MSGFLAG_HASATTACH se um ou mais anexos foram salvos e limpa MSGFLAG_UNMODIFIED para mostrar que a mensagem foi alterada.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-126">**PR_MESSAGE_FLAGS** sets MSGFLAG_HASATTACH if one or more attachments have been saved and clears MSGFLAG_UNMODIFIED to show the message has changed.</span></span> 
    
- <span data-ttu-id="e7c0e-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contém o tamanho mais atual da mensagem.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contains the most current size of the message.</span></span>
    
- <span data-ttu-id="e7c0e-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) fornece acesso à tabela de anexos.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) provides access to the attachment table.</span></span>
    
- <span data-ttu-id="e7c0e-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) fornece acesso à tabela de destinatários.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) provides access to the recipient table.</span></span>
    
<span data-ttu-id="e7c0e-130">Algumas propriedades de mensagem geralmente são fornecidas por clientes ou provedores de serviços quando uma mensagem é criada.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-130">Some message properties are typically supplied by clients or service providers when a message is created.</span></span> <span data-ttu-id="e7c0e-131">Se um cliente se esquecer de defini-los, o provedor de armazenamento de mensagens deve atualizá-lo no momento em que **SaveChanges** for chamado.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-131">If a client neglects to set them, it is up to the message store provider to update them at the time **SaveChanges** is called.</span></span> <span data-ttu-id="e7c0e-132">Por exemplo, se as propriedades **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) e **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) de uma mensagem foram definidas quando a mensagem foi criada, elas não precisam ser modificadas no momento da gravação.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-132">For example, if a message's **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) properties were set when the message was created, they need not be modified at save time.</span></span> <span data-ttu-id="e7c0e-133">No entanto, os provedores de armazenamento de mensagens que não os definirem na criação da mensagem devem defini-los na primeira vez que **SaveChanges** for chamado.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-133">However, message store providers that neglect to set them at message creation must set them the first time that **SaveChanges** is called.</span></span> 
  
<span data-ttu-id="e7c0e-134">Se **SaveChanges** retornar MAPI_E_CORRUPT_DATA, suponha que os dados que estão sendo salvos agora foram perdidos.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-134">If **SaveChanges** returns MAPI_E_CORRUPT_DATA, assume that the data being saved is now lost.</span></span> <span data-ttu-id="e7c0e-135">Provedores de armazenamento de mensagens que usam um modelo cliente-servidor para sua implementação podem retornar esse valor quando uma conexão de rede é perdida ou o servidor não está em execução.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-135">Message store providers that use a client-server model for their implementation might return this value when a network connection is lost or the server is not running.</span></span> <span data-ttu-id="e7c0e-136">Antes de retornar um erro para o usuário, tente gravar e salvar os dados uma segunda vez fazendo uma chamada para **SetProps** seguido por outra chamada para **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-136">Before returning an error to the user, try to write and save the data a second time by making a call to **SetProps** followed by another call to **SaveChanges**.</span></span> <span data-ttu-id="e7c0e-137">Se os dados são armazenados em cache localmente, isso não deve ser um problema.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-137">If the data is cached locally, this should not be a problem.</span></span> <span data-ttu-id="e7c0e-138">No entanto, se não houver cache local ou a segunda chamada **SaveChanges** falhar, exibirá um erro para alertar o usuário sobre o problema.</span><span class="sxs-lookup"><span data-stu-id="e7c0e-138">However, if there is no local cache or the second **SaveChanges** call fails, display an error to alert the user to the problem.</span></span> 
  

