---
title: Implementação de um objeto de coletor de eventos Advise
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: '�ltima altera��o: segunda-feira, 9 de mar�o de 2015'
ms.openlocfilehash: a95222f8ec75c519558636cf54111f28cbe14066
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19767420"
---
# <a name="implementing-an-advise-sink-object"></a><span data-ttu-id="63723-103">Implementação de um objeto de coletor de eventos Advise</span><span class="sxs-lookup"><span data-stu-id="63723-103">Implementing an Advise Sink Object</span></span>

  
  
<span data-ttu-id="63723-104">**Aplica-se a**: Outlook</span><span class="sxs-lookup"><span data-stu-id="63723-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="63723-105">Um cliente pode implementar seus próprios objetos de coletor de eventos advise ou usar uma função do utilitário, [HrAllocAdviseSink](hrallocadvisesink.md).</span><span class="sxs-lookup"><span data-stu-id="63723-105">A client can either implement its own advise sink objects or use a utility function, [HrAllocAdviseSink](hrallocadvisesink.md).</span></span> <span data-ttu-id="63723-106">**HrAllocAdviseSink** cria um objeto de coletor de eventos advise com uma implementação do **OnNotify** que chama uma função de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="63723-106">**HrAllocAdviseSink** creates an advise sink object with an implementation of **OnNotify** that invokes a callback function.</span></span> 
  
<span data-ttu-id="63723-107">Há vantagens e desvantagens de usar **HrAllocAdviseSink**.</span><span class="sxs-lookup"><span data-stu-id="63723-107">There are advantages and disadvantages to using **HrAllocAdviseSink**.</span></span> <span data-ttu-id="63723-108">Ele economiza seu trabalho, mas ela fornece nenhum controle sobre o objeto coletor de eventos advise que ele cria de contagem de referência.</span><span class="sxs-lookup"><span data-stu-id="63723-108">It can save work, but it provides no control over reference counting the advise sink object that it creates.</span></span> <span data-ttu-id="63723-109">Portanto, os clientes que precisar controlar cuidadosamente o lançamento do coletor de eventos seus advise ou que tenham interdependência entre seu coletor de eventos advise e outro objeto do cliente devem construir sua própria implementação **IMAPIAdviseSink** e evitar o uso de ** HrAllocAdviseSink** todo.</span><span class="sxs-lookup"><span data-stu-id="63723-109">Therefore, clients that need to carefully control their advise sink's release or that have interdependencies between their advise sink and another client object should construct their own **IMAPIAdviseSink** implementation and avoid using **HrAllocAdviseSink** altogether.</span></span> 
  
<span data-ttu-id="63723-110">Um cliente implementando seu próprio coletor de eventos advise deve facilitam um objeto independente não relacionadas à ou dependentes quaisquer outros objetos de forma a eliminar possíveis complicações versão contando e o objeto de referência.</span><span class="sxs-lookup"><span data-stu-id="63723-110">A client implementing its own advise sink should make it an independent object not related to or dependent upon any other objects so as to eliminate potential complications in reference counting and object release.</span></span> <span data-ttu-id="63723-111">No entanto, se você deve implementar seu coletor advise como parte de outro objeto ou incluir um ponteiro inverso para outro objeto como um membro de dados, é recomendável que as duas contagens de referência separada ser mantidas: um para o objeto referenciado pelo coletor de eventos advise e outro para o coletor de eventos de aviso.</span><span class="sxs-lookup"><span data-stu-id="63723-111">However, if you must implement your advise sink as part of another object or include a back pointer to another object as a data member, it is recommended that two separate reference counts be maintained: one for the object referenced by the advise sink and one for the advise sink.</span></span> 
  
<span data-ttu-id="63723-112">Quando a contagem de referência do objeto referenciado cai para zero, todos os seus métodos podem falhar e seu vtable pode ser destruído, mas a memória para o coletor de eventos advise deve permanecer intacta até após sua contagem de referência também cai para zero.</span><span class="sxs-lookup"><span data-stu-id="63723-112">When the reference count of the referenced object falls to zero, all of its methods can fail and its vtable can be destroyed, but the memory for the advise sink must remain intact until after its reference count also falls to zero.</span></span> <span data-ttu-id="63723-113">Isso significa que o método de **lançamento** do coletor de eventos advise deve diminuir sua contagem de referência e término destruir o objeto quando essa contagem chegar a zero.</span><span class="sxs-lookup"><span data-stu-id="63723-113">This means that the advise sink's **Release** method must decrement its reference count and finish destroying the object when that count reaches zero.</span></span> <span data-ttu-id="63723-114">Se não serão mantidas duas contagens de referência separada, seria fácil inadvertidamente destrua o coletor de eventos advise como parte do processo de **lançamento** do objeto abrangente.</span><span class="sxs-lookup"><span data-stu-id="63723-114">If two separate reference counts are not maintained, it would be easy to inadvertently destroy the advise sink as part of the encompassing object's **Release** process.</span></span> 
  
<span data-ttu-id="63723-115">Clientes usando o **HrAllocAdviseSink** para implementar um coletor de advise devem ser igualmente cuidadosos para não incluir suas funções de retorno de chamada como um método no objeto de coletor de eventos do outro advise.</span><span class="sxs-lookup"><span data-stu-id="63723-115">Clients using **HrAllocAdviseSink** to implement an advise sink must be equally careful not to include their callback function as a method in another advise sink object.</span></span> <span data-ttu-id="63723-116">Para clientes do C++, está tentando fazer isso e passe o ponteiro _this_ como um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="63723-116">For C++ clients, it is tempting to do this and pass the  _this_ pointer as a parameter.</span></span> <span data-ttu-id="63723-117">Essa é uma estratégia de perigosa porque os clientes geralmente liberem um objeto quando sua contagem de referência chega a zero.</span><span class="sxs-lookup"><span data-stu-id="63723-117">This is a dangerous strategy because clients typically free an object when its reference count reaches zero.</span></span> <span data-ttu-id="63723-118">Liberar a memória para o objeto coletor de eventos de advise seria renderizar o ponteiro _this_ inválido.</span><span class="sxs-lookup"><span data-stu-id="63723-118">Freeing the memory for the advise sink object would render the  _this_ pointer invalid.</span></span> 
  
<span data-ttu-id="63723-119">Dependendo do tipo de evento e a origem de advise, seu método **OnNotify** pode manipular eventos de diversas maneiras.</span><span class="sxs-lookup"><span data-stu-id="63723-119">Depending on the type of event and the advise source, your **OnNotify** method can handle events in various ways.</span></span> <span data-ttu-id="63723-120">A tabela a seguir oferece sugestões de como lidar com alguns dos eventos padrão.</span><span class="sxs-lookup"><span data-stu-id="63723-120">The following table offers suggestions in how to handle some of the standard events.</span></span> 
  
|<span data-ttu-id="63723-121">**Tipo de evento**</span><span class="sxs-lookup"><span data-stu-id="63723-121">**Type of event**</span></span>|<span data-ttu-id="63723-122">**Tratamento de OnNotify**</span><span class="sxs-lookup"><span data-stu-id="63723-122">**Handling in OnNotify**</span></span>|
|:-----|:-----|
|<span data-ttu-id="63723-123">Objeto movido</span><span class="sxs-lookup"><span data-stu-id="63723-123">Object moved</span></span>  <br/> |<span data-ttu-id="63723-124">Se o pai de original do objeto movido está relacionado ao novo pai, atualize o início do modo de exibição com a pasta ou o contêiner de catálogo de endereços mais alto na hierarquia.</span><span class="sxs-lookup"><span data-stu-id="63723-124">If the moved object's original parent is related to the new parent, update the view beginning with the folder or address book container highest in the hierarchy.</span></span> <span data-ttu-id="63723-125">Se os contêineres dois pai não estão relacionados, atualize os dois de seus modos de exibição.</span><span class="sxs-lookup"><span data-stu-id="63723-125">If the two parent containers are unrelated, update both of their views.</span></span>  <br/> |
|<span data-ttu-id="63723-126">Nova mensagem</span><span class="sxs-lookup"><span data-stu-id="63723-126">New message</span></span>  <br/> |<span data-ttu-id="63723-127">Altere a interface do usuário para informar ao usuário sobre a chegada de uma ou mais mensagens novas.</span><span class="sxs-lookup"><span data-stu-id="63723-127">Change the user interface to inform the user of the arrival of one or more new messages.</span></span> <span data-ttu-id="63723-128">Coloque a pasta de recebimento na exibição atual.</span><span class="sxs-lookup"><span data-stu-id="63723-128">Place the receive folder in the current view.</span></span>  <br/> |
|<span data-ttu-id="63723-129">Erro</span><span class="sxs-lookup"><span data-stu-id="63723-129">Error</span></span>  <br/> |<span data-ttu-id="63723-130">Para todos os objetos, exceto a sessão, faça o erro, se necessário e retorno.</span><span class="sxs-lookup"><span data-stu-id="63723-130">For all objects except the session, log the error if necessary and return.</span></span> <span data-ttu-id="63723-131">Para o objeto de sessão, faça o logoff se possível.</span><span class="sxs-lookup"><span data-stu-id="63723-131">For the session object, log off if possible.</span></span>  <br/> |
|<span data-ttu-id="63723-132">Pesquisa completa</span><span class="sxs-lookup"><span data-stu-id="63723-132">Search complete</span></span>  <br/> |<span data-ttu-id="63723-133">Nenhum processamento necessário.</span><span class="sxs-lookup"><span data-stu-id="63723-133">No processing necessary.</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="63723-134">Manipuladores de notificação devem ser reentrantes.</span><span class="sxs-lookup"><span data-stu-id="63723-134">Notification handlers should be reentrant.</span></span> 
  

