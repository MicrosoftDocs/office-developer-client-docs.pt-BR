---
title: Implementar um objeto de coletor de aviso
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: 'Última modificação: 9 de março de 2015'
ms.openlocfilehash: ecaad65d28f74b843b86ca82dab9a833ade77363
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412104"
---
# <a name="implementing-an-advise-sink-object"></a><span data-ttu-id="63798-103">Implementar um objeto de coletor de aviso</span><span class="sxs-lookup"><span data-stu-id="63798-103">Implementing an Advise Sink Object</span></span>

  
  
<span data-ttu-id="63798-104">**Aplica-se a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="63798-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="63798-105">Um cliente pode implementar seus próprios objetos de coletor de aviso ou usar uma função de utilitário, [HrAllocAdviseSink](hrallocadvisesink.md).</span><span class="sxs-lookup"><span data-stu-id="63798-105">A client can either implement its own advise sink objects or use a utility function, [HrAllocAdviseSink](hrallocadvisesink.md).</span></span> <span data-ttu-id="63798-106">**HrAllocAdviseSink** cria um objeto de coletor de aviso com uma \*\*\*\* implementação de OnNotify que invoca uma função de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="63798-106">**HrAllocAdviseSink** creates an advise sink object with an implementation of **OnNotify** that invokes a callback function.</span></span> 
  
<span data-ttu-id="63798-107">Há vantagens e desvantagens de usar o **HrAllocAdviseSink**.</span><span class="sxs-lookup"><span data-stu-id="63798-107">There are advantages and disadvantages to using **HrAllocAdviseSink**.</span></span> <span data-ttu-id="63798-108">Ele pode economizar trabalho, mas não fornece controle sobre a referência de contagem do objeto de coletor de aviso que ele cria.</span><span class="sxs-lookup"><span data-stu-id="63798-108">It can save work, but it provides no control over reference counting the advise sink object that it creates.</span></span> <span data-ttu-id="63798-109">Portanto, os clientes que precisam controlar cuidadosamente sua versão do coletor de aviso ou que têm interdependências entre o seu coletor de aviso e outro objeto de cliente devem criar sua própria implementação de **IMAPIAdviseSink** e evitar usar \*\* HrAllocAdviseSink\*\* completamente.</span><span class="sxs-lookup"><span data-stu-id="63798-109">Therefore, clients that need to carefully control their advise sink's release or that have interdependencies between their advise sink and another client object should construct their own **IMAPIAdviseSink** implementation and avoid using **HrAllocAdviseSink** altogether.</span></span> 
  
<span data-ttu-id="63798-110">Um cliente que esteja implementando seu próprio coletor de avisos deve torná-lo um objeto independente não relacionado ao ou depender de outros objetos, para eliminar possíveis complicações na contagem de referência e no lançamento do objeto.</span><span class="sxs-lookup"><span data-stu-id="63798-110">A client implementing its own advise sink should make it an independent object not related to or dependent upon any other objects so as to eliminate potential complications in reference counting and object release.</span></span> <span data-ttu-id="63798-111">No enTanto, se você deve implementar o seu coletor de aviso como parte de outro objeto ou incluir um ponteiro de retorno para outro objeto como um membro de dados, é recomendável que duas contagens de referência separadas sejam mantidas: uma para o objeto referenciado pelo coletor de aviso e outra para o coletor de aviso.</span><span class="sxs-lookup"><span data-stu-id="63798-111">However, if you must implement your advise sink as part of another object or include a back pointer to another object as a data member, it is recommended that two separate reference counts be maintained: one for the object referenced by the advise sink and one for the advise sink.</span></span> 
  
<span data-ttu-id="63798-112">Quando a contagem de referência do objeto referenciado cai para zero, todos os seus métodos podem falhar e sua vtable pode ser destruída, mas a memória do coletor de avisos deve permanecer intacta até que a contagem de referência também seja igual a zero.</span><span class="sxs-lookup"><span data-stu-id="63798-112">When the reference count of the referenced object falls to zero, all of its methods can fail and its vtable can be destroyed, but the memory for the advise sink must remain intact until after its reference count also falls to zero.</span></span> <span data-ttu-id="63798-113">Isso significa que o método **Release** do coletor de avisos deve decrementar sua contagem de referência e concluir a destruição do objeto quando essa contagem chega a zero.</span><span class="sxs-lookup"><span data-stu-id="63798-113">This means that the advise sink's **Release** method must decrement its reference count and finish destroying the object when that count reaches zero.</span></span> <span data-ttu-id="63798-114">Se duas contagens de referência separadas não forem mantidas, será fácil destruir inadvertidamente o coletor de aviso como parte do processo de **lançamento** do objeto de abrangeção.</span><span class="sxs-lookup"><span data-stu-id="63798-114">If two separate reference counts are not maintained, it would be easy to inadvertently destroy the advise sink as part of the encompassing object's **Release** process.</span></span> 
  
<span data-ttu-id="63798-115">Os clientes que usam o **HrAllocAdviseSink** para implementar um coletor de aviso devem ser igualmente cuidados de não incluir a função de retorno de chamada como um método em outro objeto de coletor de aviso.</span><span class="sxs-lookup"><span data-stu-id="63798-115">Clients using **HrAllocAdviseSink** to implement an advise sink must be equally careful not to include their callback function as a method in another advise sink object.</span></span> <span data-ttu-id="63798-116">Para clientes C++, é tentador fazer isso e passar o ponteiro como __ um parâmetro.</span><span class="sxs-lookup"><span data-stu-id="63798-116">For C++ clients, it is tempting to do this and pass the  _this_ pointer as a parameter.</span></span> <span data-ttu-id="63798-117">Essa é uma estratégia perigosa porque os clientes normalmente liberam um objeto quando sua contagem de referência chega a zero.</span><span class="sxs-lookup"><span data-stu-id="63798-117">This is a dangerous strategy because clients typically free an object when its reference count reaches zero.</span></span> <span data-ttu-id="63798-118">Liberar a memória do objeto de coletor de aviso renderizaria o __ ponteiro inválido.</span><span class="sxs-lookup"><span data-stu-id="63798-118">Freeing the memory for the advise sink object would render the  _this_ pointer invalid.</span></span> 
  
<span data-ttu-id="63798-119">Dependendo do tipo de evento e da fonte de aviso, o método **OnNotify** pode manipular eventos de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="63798-119">Depending on the type of event and the advise source, your **OnNotify** method can handle events in various ways.</span></span> <span data-ttu-id="63798-120">A tabela a seguir oferece sugestões sobre como lidar com alguns dos eventos padrão.</span><span class="sxs-lookup"><span data-stu-id="63798-120">The following table offers suggestions in how to handle some of the standard events.</span></span> 
  
|<span data-ttu-id="63798-121">**Tipo de evento**</span><span class="sxs-lookup"><span data-stu-id="63798-121">**Type of event**</span></span>|<span data-ttu-id="63798-122">**Lidando com onNotify**</span><span class="sxs-lookup"><span data-stu-id="63798-122">**Handling in OnNotify**</span></span>|
|:-----|:-----|
|<span data-ttu-id="63798-123">Objeto movido</span><span class="sxs-lookup"><span data-stu-id="63798-123">Object moved</span></span>  <br/> |<span data-ttu-id="63798-124">Se o pai original do objeto movido estiver relacionado ao novo pai, atualize o modo de exibição começando com o contêiner de pasta ou catálogo de endereços mais alto na hierarquia.</span><span class="sxs-lookup"><span data-stu-id="63798-124">If the moved object's original parent is related to the new parent, update the view beginning with the folder or address book container highest in the hierarchy.</span></span> <span data-ttu-id="63798-125">Se os dois contêineres pai não estiverem relacionados, atualize os dois modos de exibição.</span><span class="sxs-lookup"><span data-stu-id="63798-125">If the two parent containers are unrelated, update both of their views.</span></span>  <br/> |
|<span data-ttu-id="63798-126">Nova mensagem</span><span class="sxs-lookup"><span data-stu-id="63798-126">New message</span></span>  <br/> |<span data-ttu-id="63798-127">Altere a interface do usuário para informar ao usuário sobre a chegada de uma ou mais mensagens novas.</span><span class="sxs-lookup"><span data-stu-id="63798-127">Change the user interface to inform the user of the arrival of one or more new messages.</span></span> <span data-ttu-id="63798-128">Coloque a pasta receber no modo de exibição atual.</span><span class="sxs-lookup"><span data-stu-id="63798-128">Place the receive folder in the current view.</span></span>  <br/> |
|<span data-ttu-id="63798-129">Error</span><span class="sxs-lookup"><span data-stu-id="63798-129">Error</span></span>  <br/> |<span data-ttu-id="63798-130">Para todos os objetos, exceto a sessão, registre o erro se necessário e retornar.</span><span class="sxs-lookup"><span data-stu-id="63798-130">For all objects except the session, log the error if necessary and return.</span></span> <span data-ttu-id="63798-131">Para o objeto Session, faça logoff, se possível.</span><span class="sxs-lookup"><span data-stu-id="63798-131">For the session object, log off if possible.</span></span>  <br/> |
|<span data-ttu-id="63798-132">Pesquisa concluída</span><span class="sxs-lookup"><span data-stu-id="63798-132">Search complete</span></span>  <br/> |<span data-ttu-id="63798-133">Nenhum processamento necessário.</span><span class="sxs-lookup"><span data-stu-id="63798-133">No processing necessary.</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="63798-134">Manipuladores de notificação devem ser reentrante.</span><span class="sxs-lookup"><span data-stu-id="63798-134">Notification handlers should be reentrant.</span></span> 
  

