---
title: Implementar o método FlushQueues
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8719f8aa-a537-4253-b67d-c4d38c40472b
description: 'Última modificação: 9 de março de 2015'
ms.openlocfilehash: 1e5c78c71f7fddb04d3517aca0a34efa151ece08
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/23/2019
ms.locfileid: "32310112"
---
# <a name="implementing-the-flushqueues-method"></a><span data-ttu-id="7b245-103">Implementar o método FlushQueues</span><span class="sxs-lookup"><span data-stu-id="7b245-103">Implementing the FlushQueues Method</span></span>

  
  
<span data-ttu-id="7b245-104">**Aplica-se a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="7b245-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="7b245-105">O MAPI spooler usa o método [IXPLogon:: FlushQueues](ixplogon-flushqueues.md) para baixar e carregar todas as mensagens pendentes para e de um provedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="7b245-105">The MAPI spooler uses the [IXPLogon::FlushQueues](ixplogon-flushqueues.md) method to download and upload any pending messages to and from a transport provider.</span></span> <span data-ttu-id="7b245-106">Normalmente, o spooler MAPI libera as filas para todos os provedores de transporte que estão conectados à sessão, começando com o primeiro provedor de transporte, conforme definido na seção ordem de transporte do perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="7b245-106">Typically, the MAPI spooler will flush the queues for all transport providers that are logged on to the session, starting with the first transport provider as set in the transport order section of the user's profile.</span></span> <span data-ttu-id="7b245-107">A liberação de filas é quase sempre o resultado de uma solicitação direta pelo usuário, portanto, o envio e recebimento de mensagens enquanto as filas estão sendo liberadas são síncronos para o spooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="7b245-107">Flushing queues is almost always the result of a direct request by the user, so the sending and receiving of messages while queues are flushing is synchronous to the MAPI spooler.</span></span> <span data-ttu-id="7b245-108">Como essas chamadas são síncronas, o provedor de transporte deve processá-las o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="7b245-108">Because these calls are synchronous, the transport provider should process them as quickly as possible.</span></span> 
  
<span data-ttu-id="7b245-109">Os provedores de transporte devem lidar com a chamada **FlushQueues** , conforme descrito na seguinte sequência de etapas para habilitar o processamento de mensagens apropriado e para habilitar recursos externos, como modems a serem usados por outros provedores de transporte como parte do MAPI spooler Operação **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="7b245-109">Transport providers must handle the **FlushQueues** call as described in the following sequence of steps to enable proper message processing and to enable external resources such as modems to be used by other transport providers as part of the MAPI spooler's **FlushQueues** operation.</span></span> 
  
|<span data-ttu-id="7b245-110">**Etapa**</span><span class="sxs-lookup"><span data-stu-id="7b245-110">**Step**</span></span>|<span data-ttu-id="7b245-111">**Componente**</span><span class="sxs-lookup"><span data-stu-id="7b245-111">**Component**</span></span>|<span data-ttu-id="7b245-112">**Implementação**</span><span class="sxs-lookup"><span data-stu-id="7b245-112">**Implementation**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="7b245-113">1.</span><span class="sxs-lookup"><span data-stu-id="7b245-113">1.</span></span>  <br/> |<span data-ttu-id="7b245-114">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-114">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-115">Chama o método **FlushQueues** para o primeiro provedor de transporte listado na ordem de transporte do perfil do usuário, passando os sinalizadores solicitados no parâmetro _parâmetroulflags_ .</span><span class="sxs-lookup"><span data-stu-id="7b245-115">Calls the **FlushQueues** method for the first transport provider listed in the transport order of the user's profile, passing the requested flags in the  _ulFlags_ parameter.</span></span> <span data-ttu-id="7b245-116">**FlushQueues** é chamado uma vez com todos os sinalizadores definidos para a operação de upload e download inteira.</span><span class="sxs-lookup"><span data-stu-id="7b245-116">**FlushQueues** is called once with all flags set for the entire upload and download operation.</span></span>  <br/> |
|<span data-ttu-id="7b245-117">2.</span><span class="sxs-lookup"><span data-stu-id="7b245-117">2.</span></span>  <br/> |<span data-ttu-id="7b245-118">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-118">Transport Provider</span></span>  <br/> |<span data-ttu-id="7b245-119">O precisa fazer várias coisas antes de retornar da chamada **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="7b245-119">Needs to do a number of things before returning from the **FlushQueues** call.</span></span> <span data-ttu-id="7b245-120">Se as mensagens enviadas anteriormente estiverem sendo adiadas, o método [IMAPISupport:: SpoolerNotify](imapisupport-spoolernotify.md) deverá ser chamado com o sinalizador NOTIFY_SENT_DEFERRED definido.</span><span class="sxs-lookup"><span data-stu-id="7b245-120">If previously submitted messages are being deferred, the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method should be called with the NOTIFY_SENT_DEFERRED flag set.</span></span> <span data-ttu-id="7b245-121">Observe que é possível que o spooler MAPI cancele uma mensagem que tenha sido adiada antes que o provedor de transporte tenha a chance de concluir o processamento da mensagem.</span><span class="sxs-lookup"><span data-stu-id="7b245-121">Note that it is possible for the MAPI spooler to cancel a message that has been deferred before the transport provider has a chance to finish processing the message.</span></span>  <br/> <span data-ttu-id="7b245-122">Se o provedor de transporte usar um recurso externo, como um modem, a conexão com o recurso externo deverá ser estabelecida.</span><span class="sxs-lookup"><span data-stu-id="7b245-122">If the transport provider uses an external resource such as a modem, the connection to the external resource should be established.</span></span>  <br/> <span data-ttu-id="7b245-123">O bit STATUS_OUTBOUND_FLUSH na propriedade **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) da linha de status do provedor de transporte deve ser definido usando o método [IMAPISupport:: ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="7b245-123">The STATUS_OUTBOUND_FLUSH bit in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of the transport provider's status row must be set using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span>  <br/> <span data-ttu-id="7b245-124">O provedor de transporte deve retornar S_OK para a chamada **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="7b245-124">The transport provider should then return S_OK for the **FlushQueues** call.</span></span>  <br/> |
|<span data-ttu-id="7b245-125">3.</span><span class="sxs-lookup"><span data-stu-id="7b245-125">3.</span></span>  <br/> |<span data-ttu-id="7b245-126">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-126">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-127">Verifica a linha de status do provedor de transporte para o bit STATUS_OUTBOUND_FLUSH e chama [IXPLogon:: SubmitMessage](ixplogon-submitmessage.md) para a primeira mensagem na fila.</span><span class="sxs-lookup"><span data-stu-id="7b245-127">Checks the transport provider's status row for the STATUS_OUTBOUND_FLUSH bit and calls [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) for the first message in the queue.</span></span>  <br/> |
|<span data-ttu-id="7b245-128">4.</span><span class="sxs-lookup"><span data-stu-id="7b245-128">4.</span></span>  <br/> |<span data-ttu-id="7b245-129">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-129">Transport provider</span></span>  <br/> |<span data-ttu-id="7b245-130">Manipula a mensagem e retorna da chamada **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="7b245-130">Handles the message and returns from the **SubmitMessage** call.</span></span>  <br/> |
|<span data-ttu-id="7b245-131">5.</span><span class="sxs-lookup"><span data-stu-id="7b245-131">5.</span></span>  <br/> |<span data-ttu-id="7b245-132">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-132">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-133">Se o provedor de transporte retornar S_OK de **SubmitMessage**, o spooler MAPI chamará [IXPLogon:: endmessage](ixplogon-endmessage.md) da mensagem como faz com o envio de mensagem regular.</span><span class="sxs-lookup"><span data-stu-id="7b245-133">If the transport provider returns S_OK from **SubmitMessage**, the MAPI spooler calls [IXPLogon::EndMessage](ixplogon-endmessage.md) for the message as it does with regular message sending.</span></span>  <br/> <span data-ttu-id="7b245-134">Se o provedor de transporte retornar um valor diferente de S_OK de **SubmitMessage**, o spooler MAPI tratará o valor apropriadamente antes de chamar endmessage ou antes de chamar **SubmitMessage** novamente. \*\*\*\*</span><span class="sxs-lookup"><span data-stu-id="7b245-134">If the transport provider returns a value other than S_OK from **SubmitMessage**, the MAPI spooler handles the value appropriately before calling **EndMessage**, or before calling **SubmitMessage** again.</span></span>  <br/> |
|<span data-ttu-id="7b245-135">6.</span><span class="sxs-lookup"><span data-stu-id="7b245-135">6.</span></span>  <br/> |<span data-ttu-id="7b245-136">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-136">Transport provider</span></span>  <br/> |<span data-ttu-id="7b245-137">Retorna de **endmessage** com seu status de processamento de mensagens no parâmetro _lpulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="7b245-137">Returns from **EndMessage** with its message processing status in the  _lpulFlags_ parameter.</span></span>  <br/> |
|<span data-ttu-id="7b245-138">7.</span><span class="sxs-lookup"><span data-stu-id="7b245-138">7.</span></span>  <br/> |<span data-ttu-id="7b245-139">Spooler MAPI e provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-139">MAPI spooler and transport provider</span></span>  <br/> |<span data-ttu-id="7b245-140">O loop de endmessage do **SubmitMessage**- \*\*\*\* continua até que todas as mensagens na fila tenham sido baixadas.</span><span class="sxs-lookup"><span data-stu-id="7b245-140">The **SubmitMessage**- **EndMessage** loop continues until all messages in the queue have been downloaded.</span></span>  <br/> |
|<span data-ttu-id="7b245-141">8.</span><span class="sxs-lookup"><span data-stu-id="7b245-141">8.</span></span>  <br/> |<span data-ttu-id="7b245-142">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-142">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-143">Notifica o provedor de transporte que concluiu o download de mensagens chamando o método [IXPLogon:: TransportNotify](ixplogon-transportnotify.md) do provedor de transporte com o sinalizador NOTIFY_END_OUTBOUND_FLUSH definido.</span><span class="sxs-lookup"><span data-stu-id="7b245-143">Notifies the transport provider that it has finished downloading messages by calling the transport provider's [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method with the NOTIFY_END_OUTBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="7b245-144">9.</span><span class="sxs-lookup"><span data-stu-id="7b245-144">9.</span></span>  <br/> |<span data-ttu-id="7b245-145">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-145">Transport provider</span></span>  <br/> |<span data-ttu-id="7b245-146">Libera os recursos externos usados no envio de mensagens de saída para que eles possam ser usados por outros provedores de transporte para liberar suas filas.</span><span class="sxs-lookup"><span data-stu-id="7b245-146">Frees any external resources used in sending outbound messages so they can be used by other transport providers to flush their queues.</span></span>  <br/> <span data-ttu-id="7b245-147">O bit STATUS_INBOUND_FLUSH na propriedade **PR_STATUS_CODE** da linha de status do provedor de transporte deve ser definido usando o **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="7b245-147">The STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of the transport provider's status row must be set using **ModifyStatusRow**.</span></span>  <br/> |
|<span data-ttu-id="7b245-148">10.</span><span class="sxs-lookup"><span data-stu-id="7b245-148">10.</span></span>  <br/> |<span data-ttu-id="7b245-149">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-149">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-150">Verifica a linha de status do provedor de transporte para o bit STATUS_INBOUND_FLUSH e chama [IXPLogon:: StartMessage](ixplogon-startmessage.md) se estiver definido.</span><span class="sxs-lookup"><span data-stu-id="7b245-150">Checks the transport provider's status row for the STATUS_INBOUND_FLUSH bit and calls [IXPLogon::StartMessage](ixplogon-startmessage.md) if it is set.</span></span>  <br/> |
|<span data-ttu-id="7b245-151">11.</span><span class="sxs-lookup"><span data-stu-id="7b245-151">11.</span></span>  <br/> |<span data-ttu-id="7b245-152">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-152">Transport provider</span></span>  <br/> |<span data-ttu-id="7b245-153">Processa a mensagem e retorna de **StartMessage**.</span><span class="sxs-lookup"><span data-stu-id="7b245-153">Processes the message and returns from **StartMessage**.</span></span> <span data-ttu-id="7b245-154">Se o provedor de transporte tiver outras mensagens para carregar, deverá chamar **SpoolerNotify** com o sinalizador NOTIFY_NEWMAIL definido.</span><span class="sxs-lookup"><span data-stu-id="7b245-154">If the transport provider has other messages to upload, it should call **SpoolerNotify** with the NOTIFY_NEWMAIL flag set.</span></span>  <br/> <span data-ttu-id="7b245-155">Se o provedor de transporte não tiver mensagens para carregar, deverá chamar [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) na mensagem que o spooler MAPI aprovou no **StartMessage** e retornar.</span><span class="sxs-lookup"><span data-stu-id="7b245-155">If the transport provider has no messages to upload, it should call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message the MAPI spooler passed in **StartMessage** and return.</span></span>  <br/> |
|<span data-ttu-id="7b245-156">3,6.</span><span class="sxs-lookup"><span data-stu-id="7b245-156">12.</span></span>  <br/> |<span data-ttu-id="7b245-157">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-157">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-158">Continua chamando **StartMessage** até que **SaveChanges** seja chamado em uma mensagem.</span><span class="sxs-lookup"><span data-stu-id="7b245-158">Continues calling **StartMessage** until **SaveChanges** is called on a message.</span></span> <span data-ttu-id="7b245-159">Após o provedor de transporte ter concluído o carregamento, o spooler MAPI chama **TransportNotify** com o sinalizador NOTIFY_END_INBOUND_FLUSH definido.</span><span class="sxs-lookup"><span data-stu-id="7b245-159">After the transport provider has finished uploading, the MAPI spooler calls **TransportNotify** with the NOTIFY_END_INBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="7b245-160">Treze.</span><span class="sxs-lookup"><span data-stu-id="7b245-160">13.</span></span>  <br/> |<span data-ttu-id="7b245-161">Provedor de transporte</span><span class="sxs-lookup"><span data-stu-id="7b245-161">Transport provider</span></span>  <br/> |<span data-ttu-id="7b245-162">Limpa o bit STATUS_INBOUND_FLUSH na propriedade **PR_STATUS_CODE** da linha de status usando **ModifyStatusRow** e libera todos os recursos externos para que fiquem disponíveis para uso por outros provedores de transporte.</span><span class="sxs-lookup"><span data-stu-id="7b245-162">Clears the STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of its status row using **ModifyStatusRow** and releases all external resources so they are available for use by other transport providers.</span></span>  <br/> |
|<span data-ttu-id="7b245-163">14.</span><span class="sxs-lookup"><span data-stu-id="7b245-163">14.</span></span>  <br/> |<span data-ttu-id="7b245-164">Spooler MAPI</span><span class="sxs-lookup"><span data-stu-id="7b245-164">MAPI spooler</span></span>  <br/> |<span data-ttu-id="7b245-165">Chama **FlushQueues** para o próximo provedor de transporte listado na ordem de transporte do perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="7b245-165">Calls **FlushQueues** for the next transport provider listed in the transport order of the user's profile.</span></span>  <br/> |
   
<span data-ttu-id="7b245-166">Se um aplicativo cliente chama [IMAPIStatus:: FlushQueues](imapistatus-flushqueues.md) em um objeto de status do provedor de transporte, o provedor de transporte deve definir o bit apropriado em sua linha de status com **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="7b245-166">If a client application calls [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) on a transport provider's status object, the transport provider should set the appropriate bit in its status row with **ModifyStatusRow**.</span></span> <span data-ttu-id="7b245-167">O spooler MAPI chama o método **IXPLogon:: FlushQueues** do provedor de transporte na conveniência do spooler do MAPI.</span><span class="sxs-lookup"><span data-stu-id="7b245-167">The MAPI spooler then calls the transport provider's **IXPLogon::FlushQueues** method at the MAPI spooler's convenience.</span></span> <span data-ttu-id="7b245-168">Quando o método **IXPLogon:: FlushQueues** do provedor de transporte é chamado como resultado de uma chamada **IMAPIStatus:: FlushQueues** de um aplicativo cliente, a operação ocorre de forma assíncrona com o aplicativo cliente.</span><span class="sxs-lookup"><span data-stu-id="7b245-168">When the transport provider's **IXPLogon::FlushQueues** method is called as a result of a client application's **IMAPIStatus::FlushQueues** call, the operation occurs asynchronously to the client application.</span></span> <span data-ttu-id="7b245-169">Caso contrário, **IXPLogon:: FlushQueues** funciona de forma síncrona com o spooler MAPI.</span><span class="sxs-lookup"><span data-stu-id="7b245-169">Otherwise **IXPLogon::FlushQueues** works synchronously with the MAPI spooler.</span></span> 
  
<span data-ttu-id="7b245-170">Por motivos de desempenho, o spooler MAPI só chamará o método **FlushQueues** de um provedor de transporte se os sinalizadores STATUS_INBOUND_FLUSH e STATUS_OUTBOUND_FLUSH estiverem definidos na linha de status do provedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="7b245-170">For performance reasons, the MAPI spooler will only call a transport provider's **FlushQueues** method if the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH flags are set in the transport provider's status row.</span></span> <span data-ttu-id="7b245-171">Consequentemente, um provedor de transporte pode parar a operação **FlushQueues** a qualquer momento, limpando os sinalizadores STATUS_OUTBOUND_FLUSH e STATUS_INBOUND_FLUSH em sua linha de status.</span><span class="sxs-lookup"><span data-stu-id="7b245-171">Consequently, a transport provider can stop the **FlushQueues** operation at any time by clearing the STATUS_OUTBOUND_FLUSH and STATUS_INBOUND_FLUSH flags in its status row.</span></span> <span data-ttu-id="7b245-172">Se o spooler MAPI estiver sendo desligado e precisar concluir a operação **FlushQueues** , ele chamará o **TransportNotify** com os sinalizadores NOTIFY_END_INBOUND_FLUSH e NOTIFY_END_OUTBOUND_FLUSH definidos.</span><span class="sxs-lookup"><span data-stu-id="7b245-172">If the MAPI spooler is shutting down and needs to end the **FlushQueues** operation, it calls **TransportNotify** with both the NOTIFY_END_INBOUND_FLUSH and NOTIFY_END_OUTBOUND_FLUSH flags set.</span></span> <span data-ttu-id="7b245-173">O provedor de transporte deve liberar todos os recursos externos e retornar.</span><span class="sxs-lookup"><span data-stu-id="7b245-173">The transport provider should release all external resources and return.</span></span> 
  

