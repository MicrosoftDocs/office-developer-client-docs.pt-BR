---
title: Funções assíncronas definidas pelo usuário
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: 'Aplica-se a: Excel 2013�| Office 2013�| Visual Studio'
ms.openlocfilehash: 5b64dfd4308da4efb5e94010fe1dc9d758a1199c
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/11/2018
ms.locfileid: "19765247"
---
# <a name="asynchronous-user-defined-functions"></a><span data-ttu-id="2e568-103">Funções assíncronas definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2e568-103">Asynchronous user-defined functions</span></span>

<span data-ttu-id="2e568-104">**Aplica-se a**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2e568-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="2e568-105">Microsoft Excel 2013 pode chamar funções definidas pelo usuário de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="2e568-105">Microsoft Excel 2013 can call user-defined functions asynchronously.</span></span> <span data-ttu-id="2e568-106">Chamando funções de forma assíncrona pode melhorar o desempenho, permitindo que vários cálculos executar ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="2e568-106">Calling functions asynchronously can improve performance by allowing several calculations to run at the same time.</span></span> <span data-ttu-id="2e568-107">Quando você executar funções definidas pelo usuário em um cluster de computação, chamar funções de forma assíncrona permite que vários computadores a serem usadas para concluir os cálculos.</span><span class="sxs-lookup"><span data-stu-id="2e568-107">When you run user-defined functions on a compute cluster, calling functions asynchronously enables several computers to be used to complete the calculations.</span></span>
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a><span data-ttu-id="2e568-108">Quando usar funções assíncronas definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2e568-108">When to use asynchronous user-defined functions</span></span>

<span data-ttu-id="2e568-109">Algumas funções definidas pelo usuário devem aguardar por recursos externos.</span><span class="sxs-lookup"><span data-stu-id="2e568-109">Some user-defined functions must wait for external resources.</span></span> <span data-ttu-id="2e568-110">Enquanto aguardam, o thread de cálculo do Excel está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="2e568-110">While they wait, the Excel calculation thread is blocked.</span></span> <span data-ttu-id="2e568-111">No Excel 2013, funções definidas pelo usuário podem ser executado de maneira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="2e568-111">In Excel 2013, user-defined functions can run asynchronously.</span></span> <span data-ttu-id="2e568-112">Isso libera o thread de cálculo para executar outros cálculos enquanto aguarda a função definida pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="2e568-112">This frees the calculation thread to run other calculations while the user-defined function waits.</span></span>
  
<span data-ttu-id="2e568-113">No Excel 2007, programadores pode executar várias funções definidas pelo usuário ao mesmo tempo, aumentando o número de threads usados no recálculos de vários threads.</span><span class="sxs-lookup"><span data-stu-id="2e568-113">In Excel 2007, programmers could run multiple user-defined functions at the same time by increasing the number of threads used in multiple-thread recalculations.</span></span> <span data-ttu-id="2e568-114">Esse método tem desvantagens, principalmente porque o número de threads é uma configuração com escopo para um aplicativo e não pode ser controlado no nível de uma única função ou um suplemento.</span><span class="sxs-lookup"><span data-stu-id="2e568-114">This method has drawbacks primarily because the number of threads is a setting scoped to an application and cannot be controlled at the level of a single function or an add-in.</span></span>
  
<span data-ttu-id="2e568-115">Programadores devem usar chamadas assíncronas de função definida pelo usuário quando a função deve esperar para recursos externos.</span><span class="sxs-lookup"><span data-stu-id="2e568-115">Programmers should use asynchronous user-defined function calls when the function must wait for external resources.</span></span> <span data-ttu-id="2e568-116">Por exemplo, uma função que envia uma solicitação SOAP pela Internet deve aguardar a rede oferecer a solicitação, o servidor remoto para concluir a solicitação e a rede para retornar o resultado.</span><span class="sxs-lookup"><span data-stu-id="2e568-116">For example, a function that sends a SOAP request over the Internet must wait for the network to deliver the request, the remote server to complete the request, and the network to return the result.</span></span> <span data-ttu-id="2e568-117">Nesse caso, não há nenhuma ocorrência de computação significativa e Excel pode continuar com outros cálculos.</span><span class="sxs-lookup"><span data-stu-id="2e568-117">In this case, there is no significant computing occurring and Excel can continue with other calculations.</span></span>
  
<span data-ttu-id="2e568-118">Programadores também podem usar as funções assíncronas definidas pelo usuário quando uma função está enviando solicitações para um cluster de computação.</span><span class="sxs-lookup"><span data-stu-id="2e568-118">Programmers can also use asynchronous user-defined functions when a function is sending requests to a compute cluster.</span></span> <span data-ttu-id="2e568-119">Nesse caso, não há apenas a latência de rede para aguardar, mas o cluster pode executar chamadas separadas em servidores separados.</span><span class="sxs-lookup"><span data-stu-id="2e568-119">In this case, there is not only network latency to wait for, but the cluster can execute separate calls on separate servers.</span></span> <span data-ttu-id="2e568-120">Por não aguardando para cada chamada finalizar, as chamadas podem ser sobrepostas para melhorar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="2e568-120">By not waiting for each call to finish, the calls can be overlapped to improve performance.</span></span> <span data-ttu-id="2e568-121">Em alguns casos, essa melhoria é significativa.</span><span class="sxs-lookup"><span data-stu-id="2e568-121">In some cases this improvement is significant.</span></span>
  
> [!NOTE]
> <span data-ttu-id="2e568-122">Funções definidas pelo usuário não podem ser registradas como ambos assíncrona e cluster seguras.</span><span class="sxs-lookup"><span data-stu-id="2e568-122">User-defined functions cannot be registered as both asynchronous and cluster safe.</span></span> 
  
## <a name="writing-an-asynchronous-user-defined-function"></a><span data-ttu-id="2e568-123">Gravar uma função de assíncrona definidas pelo usuário</span><span class="sxs-lookup"><span data-stu-id="2e568-123">Writing an asynchronous user-defined function</span></span>

<span data-ttu-id="2e568-124">Funções assíncronas definidas pelo usuário devem ficar atento a uma alça e use esse identificador quando informando que o Excel que a chamada de função está concluída.</span><span class="sxs-lookup"><span data-stu-id="2e568-124">Asynchronous user-defined functions must keep track of a handle and use that handle when informing Excel that the function call is finished.</span></span> <span data-ttu-id="2e568-125">Uma função de assíncrona definidas pelo usuário é dividida em duas partes.</span><span class="sxs-lookup"><span data-stu-id="2e568-125">An asynchronous user-defined function is split into two pieces.</span></span> <span data-ttu-id="2e568-126">A primeira delas é o ponto de entrada UDF standard, que iniciará uma operação assíncrona em segundo lugar, separada.</span><span class="sxs-lookup"><span data-stu-id="2e568-126">The first piece is the standard UDF entry point, which will launch a second, separate asynchronous operation.</span></span> <span data-ttu-id="2e568-127">Retornos de chamada para o Excel devem ser feitos durante o ponto de entrada do UDF.</span><span class="sxs-lookup"><span data-stu-id="2e568-127">Callbacks into Excel should be made during the UDF entry point.</span></span> <span data-ttu-id="2e568-128">A primeira parte de inicialização da função retornarão o controle do seu thread de cálculo para o Excel, que continuará cálculo.</span><span class="sxs-lookup"><span data-stu-id="2e568-128">The first launching portion of the function will then return control of its calculation thread to Excel, which will continue calculation.</span></span> <span data-ttu-id="2e568-129">Quando a operação assíncrona segunda estiver concluída, ela deve chamada de retorno no Excel e oferecer ao Excel seu resultado.</span><span class="sxs-lookup"><span data-stu-id="2e568-129">When the second asynchronous operation is complete, it must call back into Excel and provide Excel with its result.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="2e568-130">Argumentos que são necessárias para a parte assíncrona passados para o UDF a função deve ser minuciosa copiado porque o Excel libera desses argumentos quando o ponto de entrada do UDF retorna.</span><span class="sxs-lookup"><span data-stu-id="2e568-130">Any arguments passed into the UDF that are needed by the asynchronous portion the function must be deep copied because Excel frees these arguments when the UDF entry point returns.</span></span> 
  
<span data-ttu-id="2e568-131">Excel fornece um conjunto de eventos que um suplemento XLL pode usar para gerenciar o ciclo de vida de chamadas UDF assíncronas.</span><span class="sxs-lookup"><span data-stu-id="2e568-131">Excel provides a set of events that an XLL add-in can use in order to manage the life cycle of asynchronous UDF calls.</span></span> <span data-ttu-id="2e568-132">Esses eventos indicam que o Excel foi concluída com cálculos ou que o cálculo foi cancelado.</span><span class="sxs-lookup"><span data-stu-id="2e568-132">These events indicate that Excel is finished with calculations or that the calculation was canceled.</span></span>
  
### <a name="declaring-an-asynchronous-function"></a><span data-ttu-id="2e568-133">Declarando uma função assíncrona</span><span class="sxs-lookup"><span data-stu-id="2e568-133">Declaring an asynchronous function</span></span>

<span data-ttu-id="2e568-134">Você deve declarar funções assíncronas definidas pelo usuário, como assíncrono quando eles são registrados.</span><span class="sxs-lookup"><span data-stu-id="2e568-134">You must declare asynchronous user-defined functions as asynchronous when they are registered.</span></span> <span data-ttu-id="2e568-135">Isso é feito adicionando um parâmetro que aponta para uma estrutura XLOPER12, representado por um "X" na sequência de tipo de registro, em qualquer lugar na lista de parâmetros UDF.</span><span class="sxs-lookup"><span data-stu-id="2e568-135">This is performed by adding a parameter that points to a XLOPER12 structure, represented by "X" in the registration type string, anywhere in the list of UDF parameters.</span></span> <span data-ttu-id="2e568-136">Excel usa esse parâmetro para passar o identificador da chamada assíncrona.</span><span class="sxs-lookup"><span data-stu-id="2e568-136">Excel uses this parameter to pass the asynchronous call handle.</span></span> <span data-ttu-id="2e568-137">O suplemento XLL deve passar o identificador da chamada assíncrona e o resultado da função para o Excel quando o resultado estiver pronto.</span><span class="sxs-lookup"><span data-stu-id="2e568-137">The XLL add-in must pass the asynchronous call handle and the result of the function back to Excel when the result is ready.</span></span> <span data-ttu-id="2e568-138">Além disso, o tipo de retorno do UDF deve estar **void**, designados por ">" como o primeiro caractere na sequência de tipo.</span><span class="sxs-lookup"><span data-stu-id="2e568-138">In addition, the return type of the UDF should be **void**, designated by ">" as the first character in the type string.</span></span> <span data-ttu-id="2e568-139">O tipo de retorno será considerada nulo porque a parte síncrona do UDF não retorna um valor para o Excel.</span><span class="sxs-lookup"><span data-stu-id="2e568-139">The return type is void because the synchronous part of the UDF does not return a value to Excel.</span></span> <span data-ttu-id="2e568-140">Em vez disso, o suplemento XLL retorna um valor de maneira assíncrona por meio de um retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="2e568-140">Instead, the XLL add-in returns a value asynchronously through a callback.</span></span> 
  
<span data-ttu-id="2e568-141">Você pode declarar funções assíncronas como thread-safe e, em seguida, a parte síncrona do UDF é usada em um recálculo multithread.</span><span class="sxs-lookup"><span data-stu-id="2e568-141">You can declare asynchronous functions as thread-safe and then the synchronous part of the UDF is used in a multi-threaded recalculation.</span></span> 
  
<span data-ttu-id="2e568-142">O exemplo de código a seguir mostra uma função definida pelo usuário assíncrona registrada usando "\>QX" como a cadeia de caracteres de tipo de registro:</span><span class="sxs-lookup"><span data-stu-id="2e568-142">The following code example shows an asynchronous user-defined function registered by using "\>QX" as the registration type string:</span></span>
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
…
}
```

### <a name="returning-values"></a><span data-ttu-id="2e568-143">Retornar valores</span><span class="sxs-lookup"><span data-stu-id="2e568-143">Returning values</span></span>

<span data-ttu-id="2e568-144">Quando o resultado da chamada assíncrona estiver pronto, o suplemento XLL retorna o resultado para o Excel, executando um retorno de chamada do tipo [xlAsyncReturn](xlasyncreturn.md).</span><span class="sxs-lookup"><span data-stu-id="2e568-144">When the result of the asynchronous call is ready, the XLL add-in returns the result to Excel by performing a callback of type [xlAsyncReturn](xlasyncreturn.md).</span></span>
  
<span data-ttu-id="2e568-145">**xlAsyncReturn** é o retorno de chamada só que pode ser usado em threads de não-cálculo durante o recálculo.</span><span class="sxs-lookup"><span data-stu-id="2e568-145">**xlAsyncReturn** is the only callback you can use on non-calculation threads during recalculation.</span></span> <span data-ttu-id="2e568-146">Portanto, a parte assíncrona de uma UDF assíncrona não deve executar outros retornos de chamada.</span><span class="sxs-lookup"><span data-stu-id="2e568-146">Therefore, the asynchronous part of an asynchronous UDF should not perform any other callbacks.</span></span> 
  
### <a name="handling-events"></a><span data-ttu-id="2e568-147">Manipulando eventos</span><span class="sxs-lookup"><span data-stu-id="2e568-147">Handling events</span></span>

<span data-ttu-id="2e568-148">Iniciando no Excel 2010, XLLs podem receber eventos projetados para gerenciar o ciclo de vida de função assíncrona.</span><span class="sxs-lookup"><span data-stu-id="2e568-148">Starting in Excel 2010, XLLs can receive events designed to manage the asynchronous function life cycle.</span></span> <span data-ttu-id="2e568-149">Para obter mais informações, consulte [Manipulação de eventos](handling-events.md).</span><span class="sxs-lookup"><span data-stu-id="2e568-149">For more information, see [Handling Events](handling-events.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="2e568-150">Confira também</span><span class="sxs-lookup"><span data-stu-id="2e568-150">See also</span></span>

- [<span data-ttu-id="2e568-151">Developing Excel XLLs</span><span class="sxs-lookup"><span data-stu-id="2e568-151">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

